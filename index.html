<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ –ê–†–ï–ù–ê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #0a0a12;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        #app {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: #0f0f17;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 20px 16px;
            overflow-y: auto;
            background: #0f0f17;
        }

        .screen.active {
            display: flex;
        }

        /* –®–∞–ø–∫–∞ –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .online-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #1a1a24;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 14px;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #3bff8b;
            border-radius: 50%;
            box-shadow: 0 0 10px #3bff8b;
        }

        .balance-card {
            background: #1a1a24;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 600;
        }

        .ton-badge {
            background: #2b2b38;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 14px;
            color: #888;
        }

        .deposit-btn {
            background: #2e7aff;
            padding: 10px 24px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 15px;
            box-shadow: 0 0 20px #2e7aff80;
        }

        /* –ú–µ–Ω—é –≤ 2 —Ä—è–¥–∞ –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .menu-item {
            background: #1a1a24;
            border-radius: 16px;
            padding: 12px 8px;
            text-align: center;
            font-size: 13px;
            color: #bbb;
            transition: all 0.2s;
        }

        .menu-item.active {
            background: #2e7aff;
            color: white;
            box-shadow: 0 0 20px #2e7aff;
        }

        .menu-item:active {
            transform: scale(0.95);
        }

        /* –¢–∞–±—ã */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: #1a1a24;
            padding: 4px;
            border-radius: 40px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            border-radius: 40px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }

        .tab.active {
            background: #2e7aff;
            box-shadow: 0 0 20px #2e7aff;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä */
        .games-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .game-card {
            background: #1a1a24;
            border-radius: 24px;
            padding: 16px;
            transition: all 0.2s;
            border: 1px solid #2a2a35;
        }

        .game-card:active {
            transform: scale(0.97);
            border-color: #2e7aff;
            box-shadow: 0 0 25px #2e7aff;
        }

        .game-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .game-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .game-multiplier {
            color: #3bff8b;
            font-size: 14px;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .inventory-item {
            background: #1a1a24;
            border-radius: 20px;
            padding: 16px 8px;
            text-align: center;
            border: 1px solid #2a2a35;
            transition: all 0.2s;
        }

        .inventory-item:active {
            border-color: #ffd966;
            box-shadow: 0 0 20px #ffd966;
        }

        .item-emoji {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .item-name {
            font-size: 13px;
            color: #aaa;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∏–≥—Ä */
        @keyframes coinFlip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(720deg); }
            100% { transform: rotateY(0); }
        }

        .coin-animate {
            animation: coinFlip 1s cubic-bezier(0.2, 0.8, 0.3, 1);
        }

        @keyframes mineExplode {
            0% { transform: scale(1); box-shadow: 0 0 0 red; }
            50% { transform: scale(1.2); box-shadow: 0 0 50px red; }
            100% { transform: scale(1); box-shadow: 0 0 0 red; }
        }

        .mine-explode {
            animation: mineExplode 0.5s ease;
        }

        @keyframes rouletteSpin {
            0% { transform: rotate(0); filter: hue-rotate(0); }
            100% { transform: rotate(720deg); filter: hue-rotate(360deg); }
        }

        .roulette-spin {
            animation: rouletteSpin 0.8s cubic-bezier(0.1, 0.8, 0.3, 1);
        }

        @keyframes winPulse {
            0% { box-shadow: 0 0 0 #3bff8b; }
            50% { box-shadow: 0 0 50px #3bff8b; }
            100% { box-shadow: 0 0 0 #3bff8b; }
        }

        .win-effect {
            animation: winPulse 0.8s ease;
        }

        /* –ü–æ–ª–µ –º–∏–Ω */
        .mines-field {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .mine-cell {
            aspect-ratio: 1;
            background: #1a1a24;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 600;
            border: 2px solid #2a2a35;
            transition: all 0.2s;
            cursor: pointer;
        }

        .mine-cell:active {
            transform: scale(0.9);
        }

        .mine-cell.revealed {
            background: #252535;
            border-color: #2e7aff;
        }

        .mine-cell.mine {
            background: #ff3b3b20;
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        .mine-cell.safe {
            background: #3bff8b20;
            border-color: #3bff8b;
            color: #3bff8b;
        }

        /* RPS –∂–µ—Å—Ç—ã */
        .gesture-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 20px 0;
        }

        .gesture-btn {
            background: #1a1a24;
            border: 2px solid #2a2a35;
            border-radius: 60px;
            padding: 20px;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            text-align: center;
        }

        .gesture-btn:active {
            transform: translateY(-5px);
            border-color: #2e7aff;
            box-shadow: 0 10px 30px #2e7aff;
        }

        .gesture-btn.selected {
            border-color: #2e7aff;
            background: #252535;
            box-shadow: 0 0 30px #2e7aff;
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: #1a1a24;
            padding: 12px 0;
            border-radius: 40px;
            margin-top: auto;
            border: 1px solid #2a2a35;
        }

        .nav-icon {
            font-size: 24px;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .nav-icon.active {
            opacity: 1;
            text-shadow: 0 0 20px #2e7aff;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù (–∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ) -->
        <div id="mainScreen" class="screen active">
            <!-- –®–∞–ø–∫–∞ -->
            <div class="header">
                <div class="online-stats">
                    <span class="online-dot"></span>
                    <span id="onlineCount">243</span>
                    <span>–æ–Ω–ª–∞–π–Ω</span>
                </div>
                <div style="color: #aaa;">@<span id="username">player</span></div>
            </div>

            <!-- –ë–∞–ª–∞–Ω—Å -->
            <div class="balance-card">
                <div class="balance-left">
                    <span>Rolls</span>
                    <span class="balance-amount" id="balance">0</span>
                    <span class="ton-badge">–¢–û–ù</span>
                </div>
                <div class="deposit-btn" onclick="showScreen('shopScreen')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
            </div>

            <!-- –ú–µ–Ω—é 4 –ø—É–Ω–∫—Ç–∞ -->
            <div class="menu-grid">
                <div class="menu-item" onclick="showScreen('inventoryScreen')">
                    <div style="font-size: 24px; margin-bottom: 4px;">üéÅ</div>
                    –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
                </div>
                <div class="menu-item" onclick="showScreen('tasksScreen')">
                    <div style="font-size: 24px; margin-bottom: 4px;">üìã</div>
                    –ó–∞–¥–∞–Ω–∏—è
                </div>
                <div class="menu-item" onclick="showScreen('referralsScreen')">
                    <div style="font-size: 24px; margin-bottom: 4px;">üë•</div>
                    –†–µ—Ñ–µ—Ä–∞–ª—ã
                </div>
                <div class="menu-item" onclick="showScreen('stakingScreen')">
                    <div style="font-size: 24px; margin-bottom: 4px;">üìà</div>
                    –°—Ç–µ–π–∫–∏–Ω–≥
                </div>
            </div>

            <!-- –¢–∞–±—ã -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('pvp')">–ü–í–ü</div>
                <div class="tab" onclick="switchTab('solo')">–°–æ–ª–æ</div>
                <div class="tab" onclick="switchTab('raffles')">–†–æ–∑—ã–≥—Ä—ã—à–∏</div>
            </div>

            <!-- –ò–≥—Ä—ã -->
            <div id="pvpGames" class="games-grid">
                <div class="game-card" data-game="rps">
                    <div class="game-icon">‚úÇÔ∏è</div>
                    <div class="game-title">RPS –î—É—ç–ª—å</div>
                    <div class="game-multiplier">x2</div>
                </div>
                <div class="game-card" data-game="coin">
                    <div class="game-icon">ü™ô</div>
                    <div class="game-title">–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                    <div class="game-multiplier">x2</div>
                </div>
            </div>

            <div id="soloGames" class="games-grid" style="display: none;">
                <div class="game-card" data-game="mines">
                    <div class="game-icon">üí£</div>
                    <div class="game-title">–ú–∏–Ω—ã 3x3</div>
                    <div class="game-multiplier">x5</div>
                </div>
                <div class="game-card" data-game="roulette">
                    <div class="game-icon">üé∞</div>
                    <div class="game-title">–†—É–ª–µ—Ç–∫–∞</div>
                    <div class="game-multiplier">x14</div>
                </div>
            </div>

            <div id="rafflesGames" class="games-grid" style="display: none;">
                <div class="game-card">
                    <div class="game-icon">üé≤</div>
                    <div class="game-title">–†–æ–∑—ã–≥—Ä—ã—à –¥–Ω—è</div>
                    <div class="game-multiplier">1000‚≠ê</div>
                </div>
                <div class="game-card">
                    <div class="game-icon">üé´</div>
                    <div class="game-title">–ë–∏–ª–µ—Ç—ã</div>
                    <div class="game-multiplier">x10</div>
                </div>
            </div>

            <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="bottom-nav">
                <div class="nav-icon active" onclick="showScreen('mainScreen')">üè†</div>
                <div class="nav-icon" onclick="showScreen('shopScreen')">üõí</div>
                <div class="nav-icon" onclick="showScreen('profileScreen')">üë§</div>
                <div class="nav-icon" onclick="showScreen('inventoryScreen')">üéÅ</div>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –ò–ì–†–´ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π) -->
        <div id="gameScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2 id="gameTitle">–ò–≥—Ä–∞</h2>
            </div>
            <div id="gameContent"></div>
        </div>

        <!-- –ò–ù–í–ï–ù–¢–ê–†–¨ -->
        <div id="inventoryScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            </div>

            <div class="balance-card" style="margin-bottom: 20px;">
                <span>–ë–∞–ª–∞–Ω—Å</span>
                <span class="balance-amount" id="inventoryBalance">0</span> ‚≠ê
            </div>

            <div class="inventory-grid" id="inventoryItems">
                <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç -->
            </div>
        </div>

        <!-- –ü–†–û–§–ò–õ–¨ -->
        <div id="profileScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
            </div>

            <div style="background: #1a1a24; border-radius: 30px; padding: 24px; text-align: center; margin-bottom: 20px;">
                <div style="width: 100px; height: 100px; background: #2e7aff; border-radius: 50%; margin: 0 auto 16px; border: 3px solid white; box-shadow: 0 0 30px #2e7aff;"></div>
                <div style="font-size: 24px; font-weight: 600;" id="profileName">Player</div>
                <div style="color: #888; margin: 8px 0;" id="profileUid">ID: loading...</div>
                <div style="display: flex; justify-content: center; gap: 20px;">
                    <div><span class="online-dot"></span> –æ–Ω–ª–∞–π–Ω</div>
                    <div>‚≠ê <span id="profileBalance">0</span></div>
                </div>
            </div>

            <div style="background: #1a1a24; border-radius: 30px; padding: 20px;">
                <h3 style="margin-bottom: 16px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</span>
                    <span id="gamesPlayed">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>–í—ã–∏–≥—Ä–∞–Ω–æ</span>
                    <span id="gamesWon">0</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–ü—Ä–æ—Ñ–∏—Ç</span>
                    <span id="totalProfit" class="text-green">0‚≠ê</span>
                </div>
            </div>
        </div>

        <!-- –ú–ê–ì–ê–ó–ò–ù -->
        <div id="shopScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
            </div>

            <div class="balance-card" style="margin-bottom: 20px;">
                <span>–í–∞—à –±–∞–ª–∞–Ω—Å</span>
                <span class="balance-amount" id="shopBalance">0</span> ‚≠ê
            </div>

            <div class="games-grid">
                <div class="game-card" onclick="buyStars(100)">
                    <div style="font-size: 32px;">‚≠ê 100</div>
                    <div style="color: #3bff8b;">+100</div>
                </div>
                <div class="game-card" onclick="buyStars(500)">
                    <div style="font-size: 32px;">‚≠ê 500</div>
                    <div style="color: #3bff8b;">+500</div>
                </div>
                <div class="game-card" onclick="buyStars(1000)">
                    <div style="font-size: 32px;">‚≠ê 1000</div>
                    <div style="color: #3bff8b;">+1000</div>
                </div>
                <div class="game-card" onclick="buyStars(2500)">
                    <div style="font-size: 32px;">‚≠ê 2500</div>
                    <div style="color: #3bff8b;">+2500</div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ -->
        <div id="tasksScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
            </div>
            <div style="background: #1a1a24; border-radius: 30px; padding: 30px; text-align: center;">
                –°–∫–æ—Ä–æ –±—É–¥—É—Ç –∑–∞–¥–∞–Ω–∏—è
            </div>
        </div>

        <div id="referralsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
            </div>
            <div style="background: #1a1a24; border-radius: 30px; padding: 30px; text-align: center;">
                –í–∞—à–∞ —Å—Å—ã–ª–∫–∞: https://t.me/duels_bot?start=${UID}
            </div>
        </div>

        <div id="stakingScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <div class="nav-icon" style="opacity: 1; font-size: 28px;" onclick="showScreen('mainScreen')">‚Üê</div>
                <h2>–°—Ç–µ–π–∫–∏–Ω–≥</h2>
            </div>
            <div style="background: #1a1a24; border-radius: 30px; padding: 30px; text-align: center;">
                APR 12% ¬∑ –°–∫–æ—Ä–æ
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø ====================
        
        // ----- Firebase -----
        const firebaseConfig = {
            apiKey: "AIzaSyDummy123456789",
            authDomain: "duels-neon.firebaseapp.com",
            databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
            projectId: "duels-neon",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ----- UID -----
        const tg = window.Telegram?.WebApp || { initDataUnsafe: { user: { id: Math.floor(Math.random() * 1000000) } } };
        const tgUser = tg.initDataUnsafe?.user;
        let UID = localStorage.getItem('duels_uid');
        
        if (!UID) {
            UID = tgUser ? 'tg_' + tgUser.id : 'local_' + Math.random().toString(36).substring(2, 10);
            localStorage.setItem('duels_uid', UID);
        }

        // ----- –°—Å—ã–ª–∫–∏ -----
        const userRef = db.ref('users/' + UID);
        const logsRef = db.ref('logs/' + UID);

        // ----- –°–æ—Å—Ç–æ—è–Ω–∏–µ -----
        let inventory = [];

        // ----- –ë–∞–ª–∞–Ω—Å -----
        async function addStars(amount) {
            let newBal = 0;
            await userRef.child('balance').transaction(b => {
                newBal = (b || 0) + amount;
                return newBal;
            });
            updateUI();
            return newBal;
        }

        async function removeStars(amount) {
            let success = false;
            await userRef.child('balance').transaction(b => {
                if (b >= amount) {
                    success = true;
                    return b - amount;
                }
                return b;
            });
            updateUI();
            return success;
        }

        // ----- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -----
        async function addItem(item) {
            inventory.push(item);
            localStorage.setItem('inventory_' + UID, JSON.stringify(inventory));
            renderInventory();
        }

        async function removeItem(itemId) {
            inventory = inventory.filter(i => i.id !== itemId);
            localStorage.setItem('inventory_' + UID, JSON.stringify(inventory));
            renderInventory();
        }

        // ----- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -----
        userRef.once('value', async (snap) => {
            if (!snap.exists()) {
                await userRef.set({
                    name: 'Player_' + UID.substring(0, 5),
                    balance: 1000,
                    online: true,
                    lastSeen: Date.now(),
                    created: Date.now(),
                    gamesPlayed: 0,
                    gamesWon: 0
                });
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const saved = localStorage.getItem('inventory_' + UID);
            if (saved) {
                inventory = JSON.parse(saved);
            } else {
                // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç
                inventory = [
                    { id: '1', name: '–ë–∏–ª–µ—Ç', emoji: 'üé´', count: 3 },
                    { id: '2', name: '–°–∫–∏–¥–∫–∞', emoji: 'üè∑Ô∏è', count: 1 }
                ];
                localStorage.setItem('inventory_' + UID, JSON.stringify(inventory));
            }
            renderInventory();
        });

        // ----- –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å -----
        function pingOnline() {
            userRef.update({ online: true, lastSeen: Date.now() });
        }
        pingOnline();
        setInterval(pingOnline, 20000);
        
        window.addEventListener('beforeunload', () => {
            userRef.update({ online: false, lastSeen: Date.now() });
        });

        // ----- –°–ª—É—à–∞—Ç–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -----
        userRef.on('value', (snap) => {
            const data = snap.val() || {};
            
            document.getElementById('username').innerText = data.name || 'player';
            document.getElementById('profileName').innerText = data.name || '‚Äî';
            document.getElementById('profileUid').innerText = 'ID: ' + UID;
            
            const balance = data.balance || 0;
            document.querySelectorAll('#balance, #inventoryBalance, #profileBalance, #shopBalance').forEach(el => {
                if (el) el.innerText = balance;
            });
            
            document.getElementById('gamesPlayed').innerText = data.gamesPlayed || 0;
            document.getElementById('gamesWon').innerText = data.gamesWon || 0;
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª-–≤–æ –æ–Ω–ª–∞–π–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
            document.getElementById('onlineCount').innerText = Math.floor(200 + Math.random() * 100);
        });

        // ----- –ù–∞–≤–∏–≥–∞—Ü–∏—è -----
        window.showScreen = function(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-icon').forEach((icon, i) => {
                const screens = ['mainScreen', 'shopScreen', 'profileScreen', 'inventoryScreen'];
                icon.classList.toggle('active', screens[i] === screenId);
            });
        };

        // ----- –¢–∞–±—ã -----
        window.switchTab = function(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('pvpGames').style.display = tab === 'pvp' ? 'grid' : 'none';
            document.getElementById('soloGames').style.display = tab === 'solo' ? 'grid' : 'none';
            document.getElementById('rafflesGames').style.display = tab === 'raffles' ? 'grid' : 'none';
        };

        // ----- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä -----
        document.querySelectorAll('[data-game]').forEach(card => {
            card.addEventListener('click', () => {
                const game = card.getAttribute('data-game');
                loadGame(game);
            });
        });

        function loadGame(gameId) {
            const gameScreen = document.getElementById('gameScreen');
            const gameTitle = document.getElementById('gameTitle');
            const gameContent = document.getElementById('gameContent');
            
            let html = '';
            
            switch(gameId) {
                case 'coin':
                    gameTitle.innerText = '–û—Ä—ë–ª –∏ –†–µ—à–∫–∞';
                    html = `
                        <div style="text-align: center;">
                            <div style="font-size: 120px; margin: 30px 0; transition: all 0.3s;" id="coin">ü™ô</div>
                            <input type="number" id="bet" class="menu-item" style="width: 100%; border: none; margin-bottom: 20px;" placeholder="–°—Ç–∞–≤–∫–∞" value="10">
                            <div class="deposit-btn" style="width: 100%;" onclick="playCoin()">–ë—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç—É</div>
                            <div id="gameMessage" style="margin-top: 20px; font-size: 18px;"></div>
                        </div>
                    `;
                    break;
                    
                case 'mines':
                    gameTitle.innerText = '–ú–∏–Ω—ã 3x3';
                    html = `
                        <div>
                            <div class="mines-field" id="minesField">
                                ${Array(9).fill(0).map((_, i) => `<div class="mine-cell" data-i="${i}">?</div>`).join('')}
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 20px 0;">
                                <span>–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="multiplier">1.0</span>x</span>
                                <span>–ë–æ–º–±: 2</span>
                            </div>
                            <input type="number" id="bet" class="menu-item" style="width: 100%; border: none; margin-bottom: 20px;" placeholder="–°—Ç–∞–≤–∫–∞" value="10">
                            <div class="btn" style="background: #1a1a24; text-align: center; padding: 16px; border-radius: 30px; margin-bottom: 10px;" onclick="resetMines()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                            <div class="deposit-btn" style="width: 100%;" onclick="cashoutMines()">–ó–∞–±—Ä–∞—Ç—å</div>
                            <div id="gameMessage" style="margin-top: 20px;"></div>
                        </div>
                    `;
                    break;
                    
                case 'rps':
                    gameTitle.innerText = '–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞';
                    html = `
                        <div>
                            <div class="gesture-selector">
                                <div class="gesture-btn" onclick="selectGesture('rock')">ü™®</div>
                                <div class="gesture-btn" onclick="selectGesture('paper')">üìÑ</div>
                                <div class="gesture-btn" onclick="selectGesture('scissors')">‚úÇÔ∏è</div>
                            </div>
                            <input type="number" id="bet" class="menu-item" style="width: 100%; border: none; margin: 20px 0;" placeholder="–°—Ç–∞–≤–∫–∞" value="10">
                            <div class="deposit-btn" style="width: 100%;" onclick="playRPS()">–ò–≥—Ä–∞—Ç—å</div>
                            <div id="gameMessage" style="margin-top: 20px; text-align: center;"></div>
                        </div>
                    `;
                    break;
                    
                case 'roulette':
                    gameTitle.innerText = '–†—É–ª–µ—Ç–∫–∞';
                    html = `
                        <div>
                            <div style="background: #1a1a24; border-radius: 30px; padding: 30px; margin: 20px 0; text-align: center;">
                                <div style="font-size: 60px; font-weight: 700;" id="rouletteNumber">0</div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <div class="menu-item" style="flex:1;" onclick="selectBet('red')">üî¥ x2</div>
                                <div class="menu-item" style="flex:1;" onclick="selectBet('black')">‚ö´ x2</div>
                                <div class="menu-item" style="flex:1;" onclick="selectBet('green')">üü¢ x14</div>
                            </div>
                            <input type="number" id="bet" class="menu-item" style="width: 100%; border: none; margin-bottom: 20px;" placeholder="–°—Ç–∞–≤–∫–∞" value="10">
                            <div class="deposit-btn" style="width: 100%;" onclick="playRoulette()">–ö—Ä—É—Ç–∏—Ç—å</div>
                            <div id="gameMessage" style="margin-top: 20px; text-align: center;"></div>
                        </div>
                    `;
                    break;
            }
            
            gameContent.innerHTML = html;
            showScreen('gameScreen');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            if (gameId === 'mines') initMines();
        }

        // ----- –ò–ì–†–ê: –û–†–Å–õ –ò –†–ï–®–ö–ê -----
        window.playCoin = async function() {
            const bet = parseInt(document.getElementById('bet').value);
            const coin = document.getElementById('coin');
            
            if (bet < 1) return;
            
            const success = await removeStars(bet);
            if (!success) {
                document.getElementById('gameMessage').innerText = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            coin.classList.add('coin-animate');
            
            setTimeout(async () => {
                coin.classList.remove('coin-animate');
                
                const win = Math.random() < 0.5;
                
                if (win) {
                    await addStars(bet * 2);
                    coin.innerText = 'ü¶Ö';
                    document.getElementById('gameMessage').innerHTML = '<span style="color: #3bff8b;">‚úÖ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ +' + bet + '‚≠ê</span>';
                    addLog('coin', bet, 'win');
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–±–µ–¥—ã
                    document.querySelector('#gameScreen .deposit-btn').classList.add('win-effect');
                    setTimeout(() => document.querySelector('#gameScreen .deposit-btn').classList.remove('win-effect'), 800);
                } else {
                    coin.innerText = 'üíÄ';
                    document.getElementById('gameMessage').innerHTML = '<span style="color: #ff3b3b;">‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à -' + bet + '‚≠ê</span>';
                    addLog('coin', bet, 'lose');
                }
            }, 600);
        };

        // ----- –ò–ì–†–ê: –ú–ò–ù–´ 3x3 -----
        let minesBoard = [];
        let minesRe
