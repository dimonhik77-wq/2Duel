import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

// --- TYPES & INTERFACES (–¥–ª—è —Å–æ–ª–∏–¥–Ω–æ—Å—Ç–∏ –≤ GitHub) ---
interface GameState {
  id: number;
  name: string;
  logo: string;
  color: string;
  stats: object;
}

// --- –ö–û–®–ï–õ–ï–ö (–°–≤–æ–π –ª–æ–≥–æ—Ç–∏–ø –∏ –∞–Ω–∏–º–∞—Ü–∏—è) ---
const CryptoWallet = () => {
  const [balance, setBalance] = useState(1.4592);
  
  return (
    <motion.div 
      initial={{ scale: 0.8, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      className="wallet-container"
    >
      {/* –õ–æ–≥–æ—Ç–∏–ø –∫–æ—à–µ–ª—å–∫–∞ - –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —â–∏—Ç */}
      <div className="wallet-logo-wrapper">
        <motion.svg 
          animate={{ rotateY: [0, 180, 360], filter: ["hue-rotate(0deg)", "hue-rotate(360deg)"] }}
          transition={{ duration: 5, repeat: Infinity, ease: "linear" }}
          width="80" height="80" viewBox="0 0 100 100"
        >
          <path d="M50 5 L90 25 V75 L50 95 L10 75 V25 L50 5Z" fill="url(#walletGrad)" />
          <defs>
            <linearGradient id="walletGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#00ffcc" />
              <stop offset="100%" stopColor="#3366ff" />
            </linearGradient>
          </defs>
        </motion.svg>
      </div>
      <h2>{balance.toFixed(4)} ETH</h2>
    </motion.div>
  );
};

// --- –ì–õ–ê–í–ù–´–ô –ö–û–ú–ü–û–ù–ï–ù–¢ ---
export default function UltimateHub() {
  const [activeTab, setActiveTab] = useState('menu');

  const games: GameState[] = [
    { id: 1, name: "CyberStrike", logo: "‚ö°", color: "#ff0055", stats: { kills: 120 } },
    { id: 2, name: "NeonDrift", logo: "üèéÔ∏è", color: "#00f2ff", stats: { distance: 5000 } },
    { id: 3, name: "VoidRunner", logo: "üåå", color: "#a100ff", stats: { level: 42 } },
    { id: 4, name: "PixelMiner", logo: "‚õèÔ∏è", color: "#ffaa00", stats: { gold: 1000 } }
  ];

  return (
    <div className="main-layout" style={{ background: '#0a0a0a', color: 'white', minHeight: '100vh', padding: '20px' }}>
      <header>
        <CryptoWallet />
      </header>

      <nav className="game-grid">
        {games.map((game) => (
          <motion.div
            key={game.id}
            whileHover={{ scale: 1.05, boxShadow: `0px 0px 20px ${game.color}` }}
            onClick={() => setActiveTab(`game-${game.id}`)}
            className="game-card"
            style={{ border: `1px solid ${game.color}`, padding: '20px', borderRadius: '15px', cursor: 'pointer' }}
          >
            {/* –õ–æ–≥–æ—Ç–∏–ø—ã –∏–≥—Ä —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π */}
            <motion.div 
              animate={{ y: [0, -10, 0] }} 
              transition={{ duration: 2, repeat: Infinity }}
              style={{ fontSize: '40px' }}
            >
              {game.logo}
            </motion.div>
            <h3>{game.name}</h3>
          </motion.div>
        ))}
      </nav>

      <main className="content-area">
        <AnimatePresence mode="wait">
          {activeTab === 'menu' && (
            <motion.div exit={{ opacity: 0 }}>
              <h1>Welcome to the Hub, Boss</h1>
              <p>–í—ã–±–µ—Ä–∏ –∏–≥—Ä—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ñ–∞—Ä–º–∏—Ç—å...</p>
            </motion.div>
          )}
          {/* –¢—É—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã –Ω–∞ 1000+ —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥–∞—è */}
        </AnimatePresence>
      </main>

      <style jsx>{`
        .game-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 40px; }
        .wallet-container { display: flex; align-items: center; gap: 20px; background: #1a1a1a; padding: 15px; border-radius: 20px; width: fit-content; }
      `}</style>
    </div>
  );
}


// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBu4aaNbvARCtvRE1SGsNpkHRYAm3NK_I0",
  authDomain: "duels-1fb6b.firebaseapp.com",
  databaseURL: "https://duels-1fb6b-default-rtdb.firebaseio.com",
  projectId: "duels-1fb6b",
  storageBucket: "duels-1fb6b.firebasestorage.app",
  messagingSenderId: "745698956226",
  appId: "1:745698956226:web:27cd811a6633946e85fc5b",
  measurementId: "G-3BS344MXBP"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
/**
 * –ö–û–†–ù–ï–í–û–ô –ú–û–î–£–õ–¨ –°–ò–°–¢–ï–ú–´ –û–ü–õ–ê–¢–´ (STARS_ENGINE_V1)
 * –∑–¥–µ—Å—å –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª—é—Ç–æ–π XTR
 */

const { Bot } = require("grammy"); // —é–∑–∞–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫

const bot = new Bot("YOUR_BOT_TOKEN");

// –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –í–´–°–¢–ê–í–õ–ï–ù–ò–Ø –°–ß–ï–¢–ê
async function createStarPayment(userId, amount, gameId) {
    console.log(`[PAYMENT] –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è —é–∑–µ—Ä–∞ ${userId} –Ω–∞ ${amount} –∑–≤—ë–∑–¥`);

    try {
        const invoice = {
            title: "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞",
            description: `–ü–æ–∫—É–ø–∫–∞ –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã –¥–ª—è –∏–≥—Ä—ã #${gameId}`,
            payload: JSON.stringify({
                uId: userId,
                gId: gameId,
                ts: Date.now()
            }),
            provider_token: "", // –í–ê–ñ–ù–û: –¥–ª—è Telegram Stars (XTR) —ç—Ç–æ –ø–æ–ª–µ –í–°–ï–ì–î–ê –ø—É—Å—Ç–æ–µ
            currency: "XTR",    // –í–û–¢ –û–ù–û! –º–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ —ç—Ç–æ –†–ï–ê–õ–¨–ù–´–ï –∑–≤–µ–∑–¥—ã
            prices: [
                { label: "Telegram Stars", amount: amount } // amount —Ç—É—Ç ‚Äî —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥
            ],
            photo_url: "https://your-server.com/assets/star_logo.png", // –ª–æ–≥–æ—Ç–∏–ø —Ç–≤–æ–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
            need_name: false,
            need_shipping_address: false,
            send_phone_number: false,
            is_flexible: false
        };

        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω–≤–æ–π—Å –≤ —á–∞—Ç —é–∑–µ—Ä—É
        return await bot.api.sendInvoice(
            userId,
            invoice.title,
            invoice.description,
            invoice.payload,
            invoice.provider_token,
            invoice.currency,
            invoice.prices,
            { photo_url: invoice.photo_url }
        );
    } catch (err) {
        console.error("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ë–ò–õ–õ–ò–ù–ì–ê:", err);
    }
}

// –û–ë–†–ê–ë–û–¢–ß–ò–ö –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø (Pre-Checkout)
// –±–µ–∑ —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –∑–≤–µ–∑–¥—ã –Ω–µ —Å–ø–∏—à—É—Ç—Å—è, —Ç–µ–ª–µ–≥–∞ –∂–¥–µ—Ç "–æ–∫" –æ—Ç —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
bot.on("pre_checkout_query", async (ctx) => {
    console.log("--- –ü–†–û–í–ï–†–ö–ê –ü–õ–ê–¢–ï–ñ–ê ---");
    // —Ç—É—Ç –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ —é–∑–µ—Ä
    await ctx.answerPreCheckoutQuery(true); 
});

// –§–ò–ù–ê–õ–¨–ù–´–ô –≠–¢–ê–ü: –ó–ê–ß–ò–°–õ–ï–ù–ò–ï
bot.on("message:successful_payment", async (ctx) => {
    const payment = ctx.message.successful_payment;
    
    if (payment.currency === "XTR") {
        console.log(`‚úÖ –ö–ê–ô–§! –∑–∞—á–∏—Å–ª–µ–Ω–æ ${payment.total_amount} –∑–≤–µ–∑–¥ —é–∑–µ—Ä—É ${ctx.from.id}`);
        // —Ç—É—Ç –≤—ã–∑—ã–≤–∞–µ—à—å —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ 4000-—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        // updatePlayerWallet(ctx.from.id, payment.total_amount);
    }
});

bot.start();
