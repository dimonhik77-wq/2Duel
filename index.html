<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ –Ω–µ–æ–Ω–æ–≤–∞—è –∞—Ä–µ–Ω–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #050509;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e0e0e7;
        }

        #app {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            max-height: 800px;
            background-color: #050509;
            border: 1px solid #14141c;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a3a inset;
            display: flex;
            flex-direction: column;
        }

        /* —ç–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 20px 16px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #2a2a3a #050509;
        }

        .screen.active {
            display: flex;
        }

        /* –Ω–µ–æ–Ω–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã */
        .neon-text {
            color: #4b6bff;
            text-shadow: 0 0 6px #4b6bff80;
        }

        .neon-border {
            border: 1px solid #3bd9d9;
            box-shadow: 0 0 10px #3bd9d980, inset 0 0 5px #3bd9d940;
        }

        .bg-accent {
            background: #0c0c14;
            border: 1px solid #2a2a3a;
            border-radius: 20px;
        }

        /* —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
        h1, h2, h3 {
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        h1 { font-size: 28px; }
        h2 { font-size: 22px; color: #b0b0c0; }
        h3 { font-size: 18px; }

        /* –∫–Ω–æ–ø–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .btn {
            background: #0f0f18;
            border: 1px solid #2f2f42;
            color: #d0d0e0;
            padding: 14px 0;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            transition: all 0.15s ease;
            cursor: pointer;
            box-shadow: 0 2px 0 #00000060;
        }

        .btn:active {
            background: #1a1a28;
            border-color: #4b6bff;
            transform: translateY(1px);
            box-shadow: 0 0 12px #4b6bff60;
        }

        .btn-neon {
            background: #12121e;
            border-color: #4b6bff;
            color: white;
            box-shadow: 0 0 10px #4b6bff60;
        }

        /* –∫–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã */
        .game-card {
            background: #0a0a12;
            border: 1px solid #20202e;
            border-radius: 24px;
            padding: 16px;
            transition: 0.1s ease;
            cursor: pointer;
        }

        .game-card:active {
            border-color: #3bd9d9;
            box-shadow: 0 0 16px #3bd9d970;
        }

        /* –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .nav-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px 0 12px;
            scrollbar-width: none;
        }

        .nav-btn {
            background: #0c0c16;
            border: 1px solid #2a2a3a;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 15px;
            white-space: nowrap;
            color: #aaaac0;
        }

        .nav-btn.active-nav {
            border-color: #4b6bff;
            color: white;
            box-shadow: 0 0 8px #4b6bff;
        }

        /* —Å–µ—Ç–∫–∞ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        /* –ø–æ–ª–µ */
        .field-5x5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        .cell {
            aspect-ratio: 1/1;
            background: #0d0d17;
            border: 1px solid #2d2d40;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #ddd;
        }

        .cell.mine {
            background: #330000;
            border-color: #ff4b4b;
            color: #ff8888;
        }

        .cell.safe {
            background: #0a1a1a;
            border-color: #3bd9d9;
            color: #3bd9d9;
        }

        /* —Ä—É–ª–µ—Ç–∫–∞ */
        .roulette-wheel {
            background: #0b0b15;
            border-radius: 100px;
            height: 60px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 600;
            border: 1px solid #2e2e44;
            transition: all 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.1);
        }

        .spin-animation {
            border-color: #4b6bff;
            box-shadow: 0 0 30px #4b6bff;
            color: white;
        }

        /* –ª–æ–±–±–∏ */
        .room-item {
            background: #0c0c16;
            border-radius: 20px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid #252535;
        }

        /* —Ñ–æ—Ä–º–∞ */
        input, .input-sim {
            background: #0b0b13;
            border: 1px solid #2c2c40;
            border-radius: 30px;
            padding: 14px 20px;
            font-size: 18px;
            color: white;
            width: 100%;
            outline: none;
        }
        input:focus {
            border-color: #4b6bff;
            box-shadow: 0 0 10px #4b6bff70;
        }

        /* —Å—Ç–∞—Ç—É—Å */
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: #3bd9d9;
            box-shadow: 0 0 8px #3bd9d9;
        }
        .offline-dot {
            background: #5a5a70;
            box-shadow: none;
        }

        /* –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050509; }
        ::-webkit-scrollbar-thumb { background: #2f2f4a; border-radius: 10px; }
    </style>
</head>
<body>
<div id="app">
    <!-- –•–ê–ë (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω) -->
    <div id="mainHub" class="screen active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <h1 style="color: white;"><span class="neon-text">DUELS</span></h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <span id="hubBalance" style="font-size: 20px; color: #3bd9d9;">0</span>
                <span style="color: #aaa;">‚≠ê</span>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <div style="width: 48px; height: 48px; border-radius: 48px; background: linear-gradient(145deg, #12121e, #020208); border: 1px solid #4b6bff;"></div>
            <div>
                <div id="hubPlayerName" style="font-size: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div style="font-size: 14px; color: #77778c;">–æ–Ω–ª–∞–π–Ω ¬∑ –¥—É—ç–ª–∏</div>
            </div>
        </div>

        <!-- –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ö–∞–±–∞ -->
        <div class="nav-row">
            <div class="nav-btn active-nav" data-screen="mainHub">–•–∞–±</div>
            <div class="nav-btn" data-screen="gamesScreen">–ò–≥—Ä—ã</div>
            <div class="nav-btn" data-screen="profileScreen">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="nav-btn" data-screen="shopScreen">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="nav-btn" data-screen="onlineLobby">–û–Ω–ª–∞–π–Ω</div>
            <div class="nav-btn" data-screen="settingsScreen">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>

        <!-- –ø—Ä–µ–≤—å—é –∏–≥—Ä (—Å–µ—Ç–∫–∞) -->
        <h3 style="margin: 16px 0 12px;">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
        <div class="grid-2">
            <div class="game-card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
            <div class="game-card" data-game="mines">üí£ –ú–∏–Ω—ã</div>
            <div class="game-card" data-game="rps">‚úÇÔ∏è –ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã</div>
            <div class="game-card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
            <div class="game-card" data-game="pvp">‚öîÔ∏è PvP –¥—É—ç–ª—å</div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –ò–ì–† (–æ–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) -->
    <div id="gamesScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ò–≥—Ä—ã</h2>
        </div>
        <div class="grid-2">
            <div class="game-card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
            <div class="game-card" data-game="mines">üí£ –ú–∏–Ω—ã</div>
            <div class="game-card" data-game="rps">‚úÇÔ∏è –ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã</div>
            <div class="game-card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
            <div class="game-card" data-game="pvp">‚öîÔ∏è PvP –¥—É—ç–ª—å</div>
        </div>
    </div>

    <!-- –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ò–ì–† (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–æ–π) -->
    <div id="gameDynamicScreen" class="screen">
        <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∏–≥—Ä–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã -->
    </div>

    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="profileScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        </div>
        <div class="bg-accent" style="padding: 24px; text-align: center;">
            <div style="width: 80px; height: 80px; border-radius: 80px; background: #12121e; margin: 0 auto 16px; border: 2px solid #4b6bff;"></div>
            <div style="font-size: 24px;" id="profileName">Name</div>
            <div style="color: #777;" id="profileUid">tg_123456</div>
            <div style="margin: 16px 0; display: flex; justify-content: center; gap: 20px;">
                <span><span class="neon-text">‚≠ê</span> <span id="profileBalance">0</span></span>
                <span><span id="profileStatus" class="online-dot" style="display: inline-block;"></span> –æ–Ω–ª–∞–π–Ω</span>
            </div>
            <div>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: <span id="profileCreated">‚Äî</span></div>
            <hr style="border-color:#222232; margin:20px 0;">
            <div style="display: flex; gap: 12px;">
                <input type="text" id="editNameInput" placeholder="–Ω–æ–≤–æ–µ –∏–º—è" style="flex:1;">
                <div class="btn btn-neon" id="saveNameBtn">OK</div>
            </div>
        </div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù (Telegram Stars) -->
    <div id="shopScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
        </div>
        <div class="bg-accent" style="padding: 24px;">
            <div style="font-size: 18px; margin-bottom: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ ‚≠ê Telegram Stars</div>
            <div class="grid-2">
                <div class="game-card" onclick="buyStars(100)">100 ‚≠ê<br><small>+100</small></div>
                <div class="game-card" onclick="buyStars(500)">500 ‚≠ê<br><small>+500</small></div>
            </div>
            <div style="margin-top: 20px; color: #aaa;">–ë–∞–ª–∞–Ω—Å: <span id="shopBalance">0</span> ‚≠ê</div>
        </div>
    </div>

    <!-- –û–ù–õ–ê–ô–ù –õ–û–ë–ë–ò -->
    <div id="onlineLobby" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–û–Ω–ª–∞–π–Ω –ª–æ–±–±–∏</h2>
        </div>
        <div style="margin-bottom: 12px; color:#3bd9d9;" id="lobbyCounter">0 –æ–Ω–ª–∞–π–Ω</div>
        <div id="roomsContainer"></div>
    </div>

    <!-- –ù–ê–°–¢–†–û–ô–ö–ò (–∑–∞–≥–ª—É—à–∫–∞) -->
    <div id="settingsScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        </div>
        <div class="bg-accent" style="padding: 20px;">–∑–¥–µ—Å—å –±—É–¥—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã/–∑–≤—É–∫–∞</div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
    (function() {
        // ---------- FIREBASE ----------
        const firebaseConfig = {
            apiKey: "AIzaSyDummy123456789",
            authDomain: "duels-neon.firebaseapp.com",
            databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
            projectId: "duels-neon",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ---------- –ì–õ–û–ë–ê–õ–¨–ù–´–ï ----------
        let UID = null;
        let userData = { name: '–ò–≥—Ä–æ–∫', avatar: '', balance: 1000, online: true, lastSeen: Date.now(), created: Date.now() };
        const tg = window.Telegram?.WebApp || { initDataUnsafe: { user: { id: 999999 } } };
        const tgUser = tg.initDataUnsafe?.user;
        if (tgUser) UID = 'tg_' + tgUser.id;
        else UID = localStorage.getItem('duels_uid') || 'local_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('duels_uid', UID);

        // —Å—Å—ã–ª–∫–∏
        const userRef = db.ref('users/' + UID);
        const logsRef = db.ref('logs/' + UID);

        // ---------- helpers –±–∞–ª–∞–Ω—Å–∞ ----------
        async function addStars(amount) {
            if (!UID) return false;
            try {
                await userRef.child('balance').transaction(b => (b || 0) + amount);
                updateUIbalance();
                return true;
            } catch { return false; }
        }
        async function removeStars(amount) {
            if (!UID) return false;
            let ok = false;
            await userRef.child('balance').transaction(b => {
                if (b >= amount) { ok = true; return b - amount; }
                else { ok = false; return b; }
            });
            updateUIbalance();
            return ok;
        }
        async function updateUIbalance() {
            const snap = await userRef.child('balance').once('value');
            const bal = snap.val() || 0;
            document.querySelectorAll('#hubBalance, #profileBalance, #shopBalance').forEach(el => { if(el) el.innerText = bal; });
        }

        // ---------- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —é–∑–µ—Ä–∞ ----------
        userRef.once('value', snap => {
            if (!snap.exists()) {
                userRef.set({
                    name: '–ò–≥—Ä–æ–∫_' + UID.substr(-4),
                    avatar: '',
                    balance: 1000,
                    online: true,
                    lastSeen: Date.now(),
                    created: Date.now()
                });
            } else {
                userData = snap.val();
            }
            // –ø–æ–¥—Ç—è–Ω–µ–º –∏–º—è –Ω–∞ —Ö–∞–±
            userRef.on('value', s => {
                const d = s.val() || {};
                document.getElementById('hubPlayerName').innerText = d.name || '‚Äî';
                document.getElementById('profileName').innerText = d.name || '‚Äî';
                document.getElementById('profileUid').innerText = UID;
                document.getElementById('profileCreated').innerText = new Date(d.created || Date.now()).toLocaleDateString();
                document.getElementById('profileBalance').innerText = d.balance || 0;
                document.getElementById('hubBalance').innerText = d.balance || 0;
                document.getElementById('shopBalance').innerText = d.balance || 0;
                // –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
                if (d.online) {
                    document.getElementById('profileStatus').classList.add('online-dot');
                    document.getElementById('profileStatus').classList.remove('offline-dot');
                } else {
                    document.getElementById('profileStatus').classList.add('offline-dot');
                    document.getElementById('profileStatus').classList.remove('online-dot');
                }
            });
        });

        // ---------- –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å (–∫–∞–∂–¥—ã–µ 20 —Å–µ–∫) ----------
        function pingOnline() {
            userRef.update({ online: true, lastSeen: Date.now() });
        }
        pingOnline();
        setInterval(pingOnline, 20000);
        window.addEventListener('beforeunload', () => {
            userRef.update({ online: false, lastSeen: Date.now() });
        });

        // ---------- –ª–æ–≥–∏ ----------
        function addLog(game, bet, result) {
            logsRef.push({ game, bet, result, time: Date.now() });
        }

        // ---------- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ ----------
        window.showScreen = function(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId)?.classList.add('active');
            if (screenId === 'onlineLobby') renderLobby();
        };

        // –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∏–≥—Ä —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
        document.querySelectorAll('[data-game]').forEach(card => {
            card.addEventListener('click', e => {
                const game = card.getAttribute('data-game');
                loadGameScreen(game);
            });
        });

        // –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —ç–∫—Ä–∞–Ω
        function loadGameScreen(gameId) {
            const container = document.getElementById('gameDynamicScreen');
            let html = '';
            if (gameId === 'coin') html = coinScreen();
            else if (gameId === 'mines') html = minesScreen();
            else if (gameId === 'rps') html = rpsScreen();
            else if (gameId === 'roulette') html = rouletteScreen();
            else if (gameId === 'pvp') html = pvpScreen();
            container.innerHTML = html;
            showScreen('gameDynamicScreen');
            // –ø—Ä–∏–≤—è–∑–∞—Ç—å –ª–æ–≥–∏–∫—É –∫–Ω–æ–ø–æ–∫ (–∏–≥—Ä–æ–≤–∞—è)
            attachGameLogic(gameId);
        }

        // ---------- –ò–ì–†–´ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã) ----------
        function coinScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 30px 20px;">
                    <div style="font-size: 48px; text-align: center; margin: 20px;" id="coinResult">ü™ô</div>
                    <input type="number" id="betCoin" placeholder="—Å—Ç–∞–≤–∫–∞" value="10" min="1">
                    <div class="btn btn-neon" style="margin: 20px 0;" id="playCoin">–ö–∏–Ω—É—Ç—å –º–æ–Ω–µ—Ç—É</div>
                    <div id="coinMessage"></div>
                </div>
            `;
        }
        function minesScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–ú–∏–Ω—ã 5x5</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div class="field-5x5" id="minesField">${Array(25).fill(0).map((_,i)=>`<div class="cell" data-i="${i}">?</div>`).join('')}</div>
                    <input type="number" id="betMines" placeholder="—Å—Ç–∞–≤–∫–∞" value="10">
                    <div class="btn" style="margin: 16px 0;" id="resetMines">–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                    <div id="minesMessage"></div>
                </div>
            `;
        }
        function rpsScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã‚Äë–±—É–º–∞–≥–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div style="display: flex; gap: 20px; justify-content: center; margin: 20px;">
                        <div class="game-card" data-rps="rock">ü™®</div>
                        <div class="game-card" data-rps="paper">üìÑ</div>
                        <div class="game-card" data-rps="scissors">‚úÇÔ∏è</div>
                    </div>
                    <input type="number" id="betRps" placeholder="—Å—Ç–∞–≤–∫–∞" value="10">
                    <div id="rpsMessage" style="text-align:center; margin:16px;"></div>
                </div>
            `;
        }
        function rouletteScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–†—É–ª–µ—Ç–∫–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div class="roulette-wheel" id="rouletteWheel">0</div>
                    <div style="display:flex; gap:6px; flex-wrap:wrap; justify-content:center;">
                        <div class="game-card" data-bet="red">üî¥ x2</div>
                        <div class="game-card" data-bet="black">‚ö´ x2</div>
                        <div class="game-card" data-bet="green">üü¢ x14</div>
                    </div>
                    <input type="number" id="betRoulette" placeholder="—Å—Ç–∞–≤–∫–∞" value="10" style="margin:16px 0;">
                    <div class="btn btn-neon" id="spinRoulette">–ö—Ä—É—Ç–∏—Ç—å</div>
                    <div id="rouletteMessage"></div>
                </div>
            `;
        }
        function pvpScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>PvP –¥—É—ç–ª—å (–±–æ—Ç)</h2>
                </div>
                <div class="bg-accent" style="padding:20px;">
                    <div style="display: flex; gap: 20px; justify-content: center; margin:20px;">
                        <div class="game-card" data-pvp="rock">ü™®</div>
                        <div class="game-card" data-pvp="paper">üìÑ</div>
                        <div class="game-card" data-pvp="scissors">‚úÇÔ∏è</div>
                    </div>
                    <input type="number" id="betPvp" value="10">
                    <div id="pvpMessage" style="margin-top:16px;"></div>
                </div>
            `;
        }

        // ---------- –ª–æ–≥–∏–∫–∞ –∏–≥—Ä ----------
        function attachGameLogic(game) {
            if (game === 'coin') {
                document.getElementById('playCoin').onclick = async () => {
                    const bet = parseInt(document.getElementById('betCoin').value);
                    if (bet <= 0) return;
                    if (!await removeStars(bet)) { document.getElementById('coinMessage').innerText = '‚ùå –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê'; return; }
                    const win = Math.random() < 0.5;
                    if (win) { await addStars(bet * 2); document.getElementById('coinResult').innerText = 'ü™ô –û–†–Å–õ'; addLog('coin', bet, 'win'); }
                    else { document.getElementById('coinResult').innerText = 'ü™ô –†–ï–®–ö–ê'; addLog('coin', bet, 'lose'); }
                    document.getElementById('coinMessage').innerText = win ? '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!' : '–ü—Ä–æ–∏–≥—Ä—ã—à';
                };
            }
            if (game === 'mines') {
                let minesActive = true, board = [], multiplier = 1, bet = 10;
                const cells = document.querySelectorAll('#minesField .cell');
                function newMines() {
                    board = Array(25).fill('safe');
                    for (let i=0; i<5; i++) { let r; do { r=Math.floor(Math.random()*25); } while(board[r]==='mine'); board[r]='mine'; }
                    multiplier = 1;
                    minesActive = true;
                    cells.forEach((c,i)=>{ c.innerText='?'; c.classList.remove('mine','safe'); });
                }
                document.getElementById('resetMines').onclick = newMines;
                newMines();
                cells.forEach(c => c.onclick = async () => {
                    if (!minesActive) return;
                    const i = c.getAttribute('data-i');
                    if (board[i] === 'mine') {
                        c.innerText = 'üí•'; c.classList.add('mine');
                        addLog('mines', bet, 'lose');
                        minesActive = false;
                        document.getElementById('minesMessage').innerText = 'üí£ –ë–æ–º–±–∞! –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª.';
                    } else if (board[i] === 'safe' && c.innerText !== '‚úî') {
                        bet = parseInt(document.getElementById('betMines').value) || 10;
                        c.innerText = '‚úî'; c.classList.add('safe');
                        multiplier += 0.2;
                        if (Array.from(cells).every(cell => board[cell.getAttribute('data-i')] === 'mine' || cell.innerText === '‚úî')) {
                            const winAmount = Math.floor(bet * multiplier);
                            await addStars(winAmount);
                            addLog('mines', bet, 'win');
                            document.getElementById('minesMessage').innerText = `üí∞ –û—á–∏—â–µ–Ω–æ! –í—ã–∏–≥—Ä—ã—à ${winAmount}`;
                            minesActive = false;
                        } else {
                            document.getElementById('minesMessage').innerText = `‚úÖ –º–Ω–æ–∂–∏—Ç–µ–ª—å ${multiplier.toFixed(2)}`;
                        }
                    }
                });
            }
            if (game === 'rps') {
                document.querySelectorAll('[data-rps]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const bet = parseInt(document.getElementById('betRps').value);
                        if (!await removeStars(bet)) { document.getElementById('rpsMessage').innerText = '‚ùå –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê'; return; }
                        const choices = ['rock','paper','scissors'];
                        const player = btn.getAttribute('data-rps');
                        const bot = choices[Math.floor(Math.random()*3)];
                        let result = 'lose';
                        if (player === bot) { await addStars(bet); result = 'draw'; }
                        else if ((player==='rock'&&bot==='scissors')||(player==='paper'&&bot==='rock')||(player==='scissors'&&bot==='paper')) {
                            await addStars(bet*2); result = 'win';
                        }
                        addLog('rps', bet, result);
                        document.getElementById('rpsMessage').innerText = `–±–æ—Ç: ${bot} ¬∑ ${result==='win'?'+'+bet:result==='draw'?'–≤–æ–∑–≤—Ä–∞—Ç':'-'+bet}`;
                    });
                });
            }
            if (game === 'roulette') {
                document.getElementById('spinRoulette').onclick = async () => {
                    const bet = parseInt(document.getElementById('betRoulette').value);
                    const color = document.querySelector('[data-bet].active-nav')?.getAttribute('data-bet') || 'red';
                    if (!await removeStars(bet)) { document.getElementById('rouletteMessage').innerText = '‚ùå'; return; }
                    const wheel = document.getElementById('rouletteWheel');
                    wheel.classList.add('spin-animation');
                    setTimeout(async () => {
                        const r = Math.random();
                        let sector = Math.floor(Math.random()*18)+1;
                        wheel.innerText = sector;
                        const isRed = [1,3,5,7,9,12,14,16,18].includes(sector);
                        let win = false, mult = 0;
                        if ((color==='red' && isRed) || (color==='black' && !isRed)) { win=true; mult=2; }
                        else if (color==='green' && sector===7) { win=true; mult=14; }
                        if (win) { await addStars(bet*mult); addLog('roulette', bet, 'win'); }
                        else addLog('roulette', bet, 'lose');
                        wheel.classList.remove('spin-animation');
                        document.getElementById('rouletteMessage').innerText = win ? `‚úÖ –≤—ã–∏–≥—Ä—ã—à ${bet*mult}` : '‚ùå –ø—Ä–æ–∏–≥—Ä—ã—à';
                    }, 500);
                };
                document.querySelectorAll('[data-bet]').forEach(b => b.onclick = function() {
                    document.querySelectorAll('[data-bet]').forEach(x=>x.classList.remove('active-nav'));
                    this.classList.add('active-nav');
                });
            }
            if (game === 'pvp') {
                document.querySelectorAll('[data-pvp]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const bet = parseInt(document.getElementById('betPvp').value);
                        if (!await removeStars(bet)) { document.getElementById('pvpMessage').innerText = '‚ùå'; return; }
                        const choices = ['rock','paper','scissors'];
                        const player = btn.getAttribute('data-pvp');
                        const bot = choices[Math.floor(Math.random()*3)];
                        let result = 'lose';
                        if (player === bot) { await addStars(bet); result = 'draw'; }
                        else if ((player==='rock'&&bot==='scissors')||(player==='paper'&&bot==='rock')||(player==='scissors'&&bot==='paper')) {
                            await addStars(bet*2); result = 'win';
                        }
                        addLog('pvp', bet, result);
                        document.getElementById('pvpMessage').innerText = `–±–æ—Ç: ${bot} ¬∑ ${result}`;
                    });
                });
            }
        }

        // ---------- –º–∞–≥–∞–∑–∏–Ω stars (–∏–º–∏—Ç–∞—Ü–∏—è) ----------
        window.buyStars = async function(amount) {
            if (window.Telegram?.WebApp?.openInvoice) {
                // –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ invoice; –¥–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏—Å–ª–∏–º
                alert('Telegram Stars invoice (demo)');
            }
            await addStars(amount);
            addLog('stars_purchase', amount, 'success');
        };

        // ---------- –ª–æ–±–±–∏ –æ–Ω–ª–∞–π–Ω ----------
        async function renderLobby() {
            const snap = await db.ref('games').once('value');
            const rooms = snap.val() || {};
            const container = document.getElementById('roomsContainer');
            container.innerHTML = '';
            Object.entries(rooms).forEach(([id, r]) => {
                if (r.status === 'open') {
                    const div = document.createElement('div');
                    div.className = 'room-item';
                    div.innerHTML = `<b>${r.game}</b> ¬∑ —Å—Ç–∞–≤–∫–∞ ${r.bet} ¬∑ ${r.p1 ? '1/2' : '–æ–∂–∏–¥–∞–Ω–∏–µ'}`;
                    container.appendChild(div);
                }
            });
            // —Å—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω —é–∑–µ—Ä–æ–≤
            const usersSnap = await db.ref('users').once('value');
            const onlineCount = Object.values(usersSnap.val() || {}).filter(u=>u.online).length;
            document.getElementById('lobbyCounter').innerText = onlineCount + ' –æ–Ω–ª–∞–π–Ω';
        }

        // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
        document.getElementById('saveNameBtn')?.addEventListener('click', () => {
            const newName = document.getElementById('editNameInput').value.trim();
            if (newName) userRef.update({ name: newName });
        });

        // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç–∞–≤–∫–∏
        window.updateUIbalance = updateUIbalance;
        setInterval(updateUIbalance, 5000);
    })();
</script>
</body>
</html>
