<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ –Ω–µ–æ–Ω–æ–≤–∞—è –∞—Ä–µ–Ω–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #050509;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e0e0e7;
        }

        #app {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            max-height: 800px;
            background-color: #050509;
            border: 1px solid #14141c;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a3a inset;
            display: flex;
            flex-direction: column;
        }

        /* —ç–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 20px 16px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #2a2a3a #050509;
        }

        .screen.active {
            display: flex;
        }

        /* –Ω–µ–æ–Ω–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã */
        .neon-text {
            color: #4b6bff;
            text-shadow: 0 0 6px #4b6bff80;
        }

        .neon-border {
            border: 1px solid #3bd9d9;
            box-shadow: 0 0 10px #3bd9d980, inset 0 0 5px #3bd9d940;
        }

        .bg-accent {
            background: #0c0c14;
            border: 1px solid #2a2a3a;
            border-radius: 20px;
        }

        /* —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
        h1, h2, h3 {
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        h1 { font-size: 28px; }
        h2 { font-size: 22px; color: #b0b0c0; }
        h3 { font-size: 18px; }

        /* –∫–Ω–æ–ø–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .btn {
            background: #0f0f18;
            border: 1px solid #2f2f42;
            color: #d0d0e0;
            padding: 14px 0;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            transition: all 0.15s ease;
            cursor: pointer;
            box-shadow: 0 2px 0 #00000060;
        }

        .btn:active {
            background: #1a1a28;
            border-color: #4b6bff;
            transform: translateY(1px);
            box-shadow: 0 0 12px #4b6bff60;
        }

        .btn-neon {
            background: #12121e;
            border-color: #4b6bff;
            color: white;
            box-shadow: 0 0 10px #4b6bff60;
        }

        /* –∫–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã */
        .game-card {
            background: #0a0a12;
            border: 1px solid #20202e;
            border-radius: 24px;
            padding: 16px;
            transition: 0.1s ease;
            cursor: pointer;
        }

        .game-card:active {
            border-color: #3bd9d9;
            box-shadow: 0 0 16px #3bd9d970;
        }

        /* –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .nav-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px 0 12px;
            scrollbar-width: none;
        }

        .nav-btn {
            background: #0c0c16;
            border: 1px solid #2a2a3a;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 15px;
            white-space: nowrap;
            color: #aaaac0;
        }

        .nav-btn.active-nav {
            border-color: #4b6bff;
            color: white;
            box-shadow: 0 0 8px #4b6bff;
        }

        /* —Å–µ—Ç–∫–∞ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        /* –ø–æ–ª–µ */
        .field-5x5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        .cell {
            aspect-ratio: 1/1;
            background: #0d0d17;
            border: 1px solid #2d2d40;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #ddd;
        }

        .cell.mine {
            background: #330000;
            border-color: #ff4b4b;
            color: #ff8888;
        }

        .cell.safe {
            background: #0a1a1a;
            border-color: #3bd9d9;
            color: #3bd9d9;
        }

        /* —Ä—É–ª–µ—Ç–∫–∞ */
        .roulette-wheel {
            background: #0b0b15;
            border-radius: 100px;
            height: 60px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 600;
            border: 1px solid #2e2e44;
            transition: all 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.1);
        }

        .spin-animation {
            border-color: #4b6bff;
            box-shadow: 0 0 30px #4b6bff;
            color: white;
        }

        /* –ª–æ–±–±–∏ */
        .room-item {
            background: #0c0c16;
            border-radius: 20px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid #252535;
        }

        /* —Ñ–æ—Ä–º–∞ */
        input, .input-sim {
            background: #0b0b13;
            border: 1px solid #2c2c40;
            border-radius: 30px;
            padding: 14px 20px;
            font-size: 18px;
            color: white;
            width: 100%;
            outline: none;
        }
        input:focus {
            border-color: #4b6bff;
            box-shadow: 0 0 10px #4b6bff70;
        }

        /* —Å—Ç–∞—Ç—É—Å */
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: #3bd9d9;
            box-shadow: 0 0 8px #3bd9d9;
        }
        .offline-dot {
            background: #5a5a70;
            box-shadow: none;
        }

        /* –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050509; }
        ::-webkit-scrollbar-thumb { background: #2f2f4a; border-radius: 10px; }
    </style>
</head>
<body>
<div id="app">
    <!-- –•–ê–ë (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω) -->
    <div id="mainHub" class="screen active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <h1 style="color: white;"><span class="neon-text">DUELS</span></h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <span id="hubBalance" style="font-size: 20px; color: #3bd9d9;">0</span>
                <span style="color: #aaa;">‚≠ê</span>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <div style="width: 48px; height: 48px; border-radius: 48px; background: linear-gradient(145deg, #12121e, #020208); border: 1px solid #4b6bff;"></div>
            <div>
                <div id="hubPlayerName" style="font-size: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div style="font-size: 14px; color: #77778c;">–æ–Ω–ª–∞–π–Ω ¬∑ –¥—É—ç–ª–∏</div>
            </div>
        </div>

        <!-- –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ö–∞–±–∞ -->
        <div class="nav-row">
            <div class="nav-btn active-nav" data-screen="mainHub">–•–∞–±</div>
            <div class="nav-btn" data-screen="gamesScreen">–ò–≥—Ä—ã</div>
            <div class="nav-btn" data-screen="profileScreen">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="nav-btn" data-screen="shopScreen">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="nav-btn" data-screen="onlineLobby">–û–Ω–ª–∞–π–Ω</div>
            <div class="nav-btn" data-screen="settingsScreen">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>

        <!-- –ø—Ä–µ–≤—å—é –∏–≥—Ä (—Å–µ—Ç–∫–∞) -->
        <h3 style="margin: 16px 0 12px;">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
        <div class="grid-2">
            <div class="game-card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
            <div class="game-card" data-game="mines">üí£ –ú–∏–Ω—ã</div>
            <div class="game-card" data-game="rps">‚úÇÔ∏è –ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã</div>
            <div class="game-card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
            <div class="game-card" data-game="pvp">‚öîÔ∏è PvP –¥—É—ç–ª—å</div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –ò–ì–† (–æ–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) -->
    <div id="gamesScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ò–≥—Ä—ã</h2>
        </div>
        <div class="grid-2">
            <div class="game-card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
            <div class="game-card" data-game="mines">üí£ –ú–∏–Ω—ã</div>
            <div class="game-card" data-game="rps">‚úÇÔ∏è –ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã</div>
            <div class="game-card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
            <div class="game-card" data-game="pvp">‚öîÔ∏è PvP –¥—É—ç–ª—å</div>
        </div>
    </div>

    <!-- –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ò–ì–† (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–æ–π) -->
    <div id="gameDynamicScreen" class="screen">
        <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∏–≥—Ä–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã -->
    </div>

    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="profileScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        </div>
        <div class="bg-accent" style="padding: 24px; text-align: center;">
            <div style="width: 80px; height: 80px; border-radius: 80px; background: #12121e; margin: 0 auto 16px; border: 2px solid #4b6bff;"></div>
            <div style="font-size: 24px;" id="profileName">Name</div>
            <div style="color: #777;" id="profileUid">tg_123456</div>
            <div style="margin: 16px 0; display: flex; justify-content: center; gap: 20px;">
                <span><span class="neon-text">‚≠ê</span> <span id="profileBalance">0</span></span>
                <span><span id="profileStatus" class="online-dot" style="display: inline-block;"></span> –æ–Ω–ª–∞–π–Ω</span>
            </div>
            <div>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: <span id="profileCreated">‚Äî</span></div>
            <hr style="border-color:#222232; margin:20px 0;">
            <div style="display: flex; gap: 12px;">
                <input type="text" id="editNameInput" placeholder="–Ω–æ–≤–æ–µ –∏–º—è" style="flex:1;">
                <div class="btn btn-neon" id="saveNameBtn">OK</div>
            </div>
        </div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù (Telegram Stars) -->
    <div id="shopScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
        </div>
        <div class="bg-accent" style="padding: 24px;">
            <div style="font-size: 18px; margin-bottom: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ ‚≠ê Telegram Stars</div>
            <div class="grid-2">
                <div class="game-card" onclick="buyStars(100)">100 ‚≠ê<br><small>+100</small></div>
                <div class="game-card" onclick="buyStars(500)">500 ‚≠ê<br><small>+500</small></div>
            </div>
            <div style="margin-top: 20px; color: #aaa;">–ë–∞–ª–∞–Ω—Å: <span id="shopBalance">0</span> ‚≠ê</div>
        </div>
    </div>

    <!-- –û–ù–õ–ê–ô–ù –õ–û–ë–ë–ò -->
    <div id="onlineLobby" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–û–Ω–ª–∞–π–Ω –ª–æ–±–±–∏</h2>
        </div>
        <div style="margin-bottom: 12px; color:#3bd9d9;" id="lobbyCounter">0 –æ–Ω–ª–∞–π–Ω</div>
        <div id="roomsContainer"></div>
    </div>

    <!-- –ù–ê–°–¢–†–û–ô–ö–ò (–∑–∞–≥–ª—É—à–∫–∞) -->
    <div id="settingsScreen" class="screen">
        <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
            <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        </div>
        <div class="bg-accent" style="padding: 20px;">–∑–¥–µ—Å—å –±—É–¥—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã/–∑–≤—É–∫–∞</div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
    (function() {
        // ---------- FIREBASE ----------
        const firebaseConfig = {
            apiKey: "AIzaSyDummy123456789",
            authDomain: "duels-neon.firebaseapp.com",
            databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
            projectId: "duels-neon",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ---------- –ì–õ–û–ë–ê–õ–¨–ù–´–ï ----------
        let UID = null;
        let userData = { name: '–ò–≥—Ä–æ–∫', avatar: '', balance: 1000, online: true, lastSeen: Date.now(), created: Date.now() };
        const tg = window.Telegram?.WebApp || { initDataUnsafe: { user: { id: 999999 } } };
        const tgUser = tg.initDataUnsafe?.user;
        if (tgUser) UID = 'tg_' + tgUser.id;
        else UID = localStorage.getItem('duels_uid') || 'local_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('duels_uid', UID);

        // —Å—Å—ã–ª–∫–∏
        const userRef = db.ref('users/' + UID);
        const logsRef = db.ref('logs/' + UID);

        // ---------- helpers –±–∞–ª–∞–Ω—Å–∞ ----------
        async function addStars(amount) {
            if (!UID) return false;
            try {
                await userRef.child('balance').transaction(b => (b || 0) + amount);
                updateUIbalance();
                return true;
            } catch { return false; }
        }
        async function removeStars(amount) {
            if (!UID) return false;
            let ok = false;
            await userRef.child('balance').transaction(b => {
                if (b >= amount) { ok = true; return b - amount; }
                else { ok = false; return b; }
            });
            updateUIbalance();
            return ok;
        }
        async function updateUIbalance() {
            const snap = await userRef.child('balance').once('value');
            const bal = snap.val() || 0;
            document.querySelectorAll('#hubBalance, #profileBalance, #shopBalance').forEach(el => { if(el) el.innerText = bal; });
        }

        // ---------- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —é–∑–µ—Ä–∞ ----------
        userRef.once('value', snap => {
            if (!snap.exists()) {
                userRef.set({
                    name: '–ò–≥—Ä–æ–∫_' + UID.substr(-4),
                    avatar: '',
                    balance: 1000,
                    online: true,
                    lastSeen: Date.now(),
                    created: Date.now()
                });
            } else {
                userData = snap.val();
            }
            // –ø–æ–¥—Ç—è–Ω–µ–º –∏–º—è –Ω–∞ —Ö–∞–±
            userRef.on('value', s => {
                const d = s.val() || {};
                document.getElementById('hubPlayerName').innerText = d.name || '‚Äî';
                document.getElementById('profileName').innerText = d.name || '‚Äî';
                document.getElementById('profileUid').innerText = UID;
                document.getElementById('profileCreated').innerText = new Date(d.created || Date.now()).toLocaleDateString();
                document.getElementById('profileBalance').innerText = d.balance || 0;
                document.getElementById('hubBalance').innerText = d.balance || 0;
                document.getElementById('shopBalance').innerText = d.balance || 0;
                // –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
                if (d.online) {
                    document.getElementById('profileStatus').classList.add('online-dot');
                    document.getElementById('profileStatus').classList.remove('offline-dot');
                } else {
                    document.getElementById('profileStatus').classList.add('offline-dot');
                    document.getElementById('profileStatus').classList.remove('online-dot');
                }
            });
        });

        // ---------- –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å (–∫–∞–∂–¥—ã–µ 20 —Å–µ–∫) ----------
        function pingOnline() {
            userRef.update({ online: true, lastSeen: Date.now() });
        }
        pingOnline();
        setInterval(pingOnline, 20000);
        window.addEventListener('beforeunload', () => {
            userRef.update({ online: false, lastSeen: Date.now() });
        });

        // ---------- –ª–æ–≥–∏ ----------
        function addLog(game, bet, result) {
            logsRef.push({ game, bet, result, time: Date.now() });
        }

        // ---------- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ ----------
        window.showScreen = function(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId)?.classList.add('active');
            if (screenId === 'onlineLobby') renderLobby();
        };

        // –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∏–≥—Ä —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
        document.querySelectorAll('[data-game]').forEach(card => {
            card.addEventListener('click', e => {
                const game = card.getAttribute('data-game');
                loadGameScreen(game);
            });
        });

        // –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —ç–∫—Ä–∞–Ω
        function loadGameScreen(gameId) {
            const container = document.getElementById('gameDynamicScreen');
            let html = '';
            if (gameId === 'coin') html = coinScreen();
            else if (gameId === 'mines') html = minesScreen();
            else if (gameId === 'rps') html = rpsScreen();
            else if (gameId === 'roulette') html = rouletteScreen();
            else if (gameId === 'pvp') html = pvpScreen();
            container.innerHTML = html;
            showScreen('gameDynamicScreen');
            // –ø—Ä–∏–≤—è–∑–∞—Ç—å –ª–æ–≥–∏–∫—É –∫–Ω–æ–ø–æ–∫ (–∏–≥—Ä–æ–≤–∞—è)
            attachGameLogic(gameId);
        }

        // ---------- –ò–ì–†–´ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã) ----------
        function coinScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 30px 20px;">
                    <div style="font-size: 48px; text-align: center; margin: 20px;" id="coinResult">ü™ô</div>
                    <input type="number" id="betCoin" placeholder="—Å—Ç–∞–≤–∫–∞" value="10" min="1">
                    <div class="btn btn-neon" style="margin: 20px 0;" id="playCoin">–ö–∏–Ω—É—Ç—å –º–æ–Ω–µ—Ç—É</div>
                    <div id="coinMessage"></div>
                </div>
            `;
        }
        function minesScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–ú–∏–Ω—ã 5x5</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div class="field-5x5" id="minesField">${Array(25).fill(0).map((_,i)=>`<div class="cell" data-i="${i}">?</div>`).join('')}</div>
                    <input type="number" id="betMines" placeholder="—Å—Ç–∞–≤–∫–∞" value="10">
                    <div class="btn" style="margin: 16px 0;" id="resetMines">–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                    <div id="minesMessage"></div>
                </div>
            `;
        }
        function rpsScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–ö–∞–º–µ–Ω—å‚Äë–Ω–æ–∂–Ω–∏—Ü—ã‚Äë–±—É–º–∞–≥–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div style="display: flex; gap: 20px; justify-content: center; margin: 20px;">
                        <div class="game-card" data-rps="rock">ü™®</div>
                        <div class="game-card" data-rps="paper">üìÑ</div>
                        <div class="game-card" data-rps="scissors">‚úÇÔ∏è</div>
                    </div>
                    <input type="number" id="betRps" placeholder="—Å—Ç–∞–≤–∫–∞" value="10">
                    <div id="rpsMessage" style="text-align:center; margin:16px;"></div>
                </div>
            `;
        }
        function rouletteScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>–†—É–ª–µ—Ç–∫–∞</h2>
                </div>
                <div class="bg-accent" style="padding: 20px;">
                    <div class="roulette-wheel" id="rouletteWheel">0</div>
                    <div style="display:flex; gap:6px; flex-wrap:wrap; justify-content:center;">
                        <div class="game-card" data-bet="red">üî¥ x2</div>
                        <div class="game-card" data-bet="black">‚ö´ x2</div>
                        <div class="game-card" data-bet="green">üü¢ x14</div>
                    </div>
                    <input type="number" id="betRoulette" placeholder="—Å—Ç–∞–≤–∫–∞" value="10" style="margin:16px 0;">
                    <div class="btn btn-neon" id="spinRoulette">–ö—Ä—É—Ç–∏—Ç—å</div>
                    <div id="rouletteMessage"></div>
                </div>
            `;
        }
        function pvpScreen() {
            return `
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                    <div class="btn" style="width: 50px; padding: 10px;" onclick="showScreen('mainHub')">‚Üê</div>
                    <h2>PvP –¥—É—ç–ª—å (–±–æ—Ç)</h2>
                </div>
                <div class="bg-accent" style="padding:20px;">
                    <div style="display: flex; gap: 20px; justify-content: center; margin:20px;">
                        <div class="game-card" data-pvp="rock">ü™®</div>
                        <div class="game-card" data-pvp="paper">üìÑ</div>
                        <div class="game-card" data-pvp="scissors">‚úÇÔ∏è</div>
                    </div>
                    <input type="number" id="betPvp" value="10">
                    <div id="pvpMessage" style="margin-top:16px;"></div>
                </div>
            `;
        }

        // ---------- –ª–æ–≥–∏–∫–∞ –∏–≥—Ä ----------
        function attachGameLogic(game) {
            if (game === 'coin') {
                document.getElementById('playCoin').onclick = async () => {
                    const bet = parseInt(document.getElementById('betCoin').value);
                    if (bet <= 0) return;
                    if (!await removeStars(bet)) { document.getElementById('coinMessage').innerText = '‚ùå –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê'; return; }
                    const win = Math.random() < 0.5;
                    if (win) { await addStars(bet * 2); document.getElementById('coinResult').innerText = 'ü™ô –û–†–Å–õ'; addLog('coin', bet, 'win'); }
                    else { document.getElementById('coinResult').innerText = 'ü™ô –†–ï–®–ö–ê'; addLog('coin', bet, 'lose'); }
                    document.getElementById('coinMessage').innerText = win ? '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!' : '–ü—Ä–æ–∏–≥—Ä—ã—à';
                };
            }
            if (game === 'mines') {
                let minesActive = true, board = [], multiplier = 1, bet = 10;
                const cells = document.querySelectorAll('#minesField .cell');
                function newMines() {
                    board = Array(25).fill('safe');
                    for (let i=0; i<5; i++) { let r; do { r=Math.floor(Math.random()*25); } while(board[r]==='mine'); board[r]='mine'; }
                    multiplier = 1;
                    minesActive = true;
                    cells.forEach((c,i)=>{ c.innerText='?'; c.classList.remove('mine','safe'); });
                }
                document.getElementById('resetMines').onclick = newMines;
                newMines();
                cells.forEach(c => c.onclick = async () => {
                    if (!minesActive) return;
                    const i = c.getAttribute('data-i');
                    if (board[i] === 'mine') {
                        c.innerText = 'üí•'; c.classList.add('mine');
                        addLog('mines', bet, 'lose');
                        minesActive = false;
                        document.getElementById('minesMessage').innerText = 'üí£ –ë–æ–º–±–∞! –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª.';
                    } else if (board[i] === 'safe' && c.innerText !== '‚úî') {
                        bet = parseInt(document.getElementById('betMines').value) || 10;
                        c.innerText = '‚úî'; c.classList.add('safe');
                        multiplier += 0.2;
                        if (Array.from(cells).every(cell => board[cell.getAttribute('data-i')] === 'mine' || cell.innerText === '‚úî')) {
                            const winAmount = Math.floor(bet * multiplier);
                            await addStars(winAmount);
                            addLog('mines', bet, 'win');
                            document.getElementById('minesMessage').innerText = `üí∞ –û—á–∏—â–µ–Ω–æ! –í—ã–∏–≥—Ä—ã—à ${winAmount}`;
                            minesActive = false;
                        } else {
                            document.getElementById('minesMessage').innerText = `‚úÖ –º–Ω–æ–∂–∏—Ç–µ–ª—å ${multiplier.toFixed(2)}`;
                        }
                    }
                });
            }
            if (game === 'rps') {
                document.querySelectorAll('[data-rps]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const bet = parseInt(document.getElementById('betRps').value);
                        if (!await removeStars(bet)) { document.getElementById('rpsMessage').innerText = '‚ùå –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê'; return; }
                        const choices = ['rock','paper','scissors'];
                        const player = btn.getAttribute('data-rps');
                        const bot = choices[Math.floor(Math.random()*3)];
                        let result = 'lose';
                        if (player === bot) { await addStars(bet); result = 'draw'; }
                        else if ((player==='rock'&&bot==='scissors')||(player==='paper'&&bot==='rock')||(player==='scissors'&&bot==='paper')) {
                            await addStars(bet*2); result = 'win';
                        }
                        addLog('rps', bet, result);
                        document.getElementById('rpsMessage').innerText = `–±–æ—Ç: ${bot} ¬∑ ${result==='win'?'+'+bet:result==='draw'?'–≤–æ–∑–≤—Ä–∞—Ç':'-'+bet}`;
                    });
                });
            }
            if (game === 'roulette') {
                document.getElementById('spinRoulette').onclick = async () => {
                    const bet = parseInt(document.getElementById('betRoulette').value);
                    const color = document.querySelector('[data-bet].active-nav')?.getAttribute('data-bet') || 'red';
                    if (!await removeStars(bet)) { document.getElementById('rouletteMessage').innerText = '‚ùå'; return; }
                    const wheel = document.getElementById('rouletteWheel');
                    wheel.classList.add('spin-animation');
                    setTimeout(async () => {
                        const r = Math.random();
                        let sector = Math.floor(Math.random()*18)+1;
                        wheel.innerText = sector;
                        const isRed = [1,3,5,7,9,12,14,16,18].includes(sector);
                        let win = false, mult = 0;
                        if ((color==='red' && isRed) || (color==='black' && !isRed)) { win=true; mult=2; }
                        else if (color==='green' && sector===7) { win=true; mult=14; }
                        if (win) { await addStars(bet*mult); addLog('roulette', bet, 'win'); }
                        else addLog('roulette', bet, 'lose');
                        wheel.classList.remove('spin-animation');
                        document.getElementById('rouletteMessage').innerText = win ? `‚úÖ –≤—ã–∏–≥—Ä—ã—à ${bet*mult}` : '‚ùå –ø—Ä–æ–∏–≥—Ä—ã—à';
                    }, 500);
                };
                document.querySelectorAll('[data-bet]').forEach(b => b.onclick = function() {
                    document.querySelectorAll('[data-bet]').forEach(x=>x.classList.remove('active-nav'));
                    this.classList.add('active-nav');
                });
            }
            if (game === 'pvp') {
                document.querySelectorAll('[data-pvp]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const bet = parseInt(document.getElementById('betPvp').value);
                        if (!await removeStars(bet)) { document.getElementById('pvpMessage').innerText = '‚ùå'; return; }
                        const choices = ['rock','paper','scissors'];
                        const player = btn.getAttribute('data-pvp');
                        const bot = choices[Math.floor(Math.random()*3)];
                        let result = 'lose';
                        if (player === bot) { await addStars(bet); result = 'draw'; }
                        else if ((player==='rock'&&bot==='scissors')||(player==='paper'&&bot==='rock')||(player==='scissors'&&bot==='paper')) {
                            await addStars(bet*2); result = 'win';
                        }
                        addLog('pvp', bet, result);
                        document.getElementById('pvpMessage').innerText = `–±–æ—Ç: ${bot} ¬∑ ${result}`;
                    });
                });
            }
        }

        // ---------- –º–∞–≥–∞–∑–∏–Ω stars (–∏–º–∏—Ç–∞—Ü–∏—è) ----------
        window.buyStars = async function(amount) {
            if (window.Telegram?.WebApp?.openInvoice) {
                // –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ invoice; –¥–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏—Å–ª–∏–º
                alert('Telegram Stars invoice (demo)');
            }
            await addStars(amount);
            addLog('stars_purchase', amount, 'success');
        };

        // ---------- –ª–æ–±–±–∏ –æ–Ω–ª–∞–π–Ω ----------
        async function renderLobby() {
            const snap = await db.ref('games').once('value');
            const rooms = snap.val() || {};
            const container = document.getElementById('roomsContainer');
            container.innerHTML = '';
            Object.entries(rooms).forEach(([id, r]) => {
                if (r.status === 'open') {
                    const div = document.createElement('div');
                    div.className = 'room-item';
                    div.innerHTML = `<b>${r.game}</b> ¬∑ —Å—Ç–∞–≤–∫–∞ ${r.bet} ¬∑ ${r.p1 ? '1/2' : '–æ–∂–∏–¥–∞–Ω–∏–µ'}`;
                    container.appendChild(div);
                }
            });
            // —Å—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω —é–∑–µ—Ä–æ–≤
            const usersSnap = await db.ref('users').once('value');
            const onlineCount = Object.values(usersSnap.val() || {}).filter(u=>u.online).length;
            document.getElementById('lobbyCounter').innerText = onlineCount + ' –æ–Ω–ª–∞–π–Ω';
        }

        // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
        document.getElementById('saveNameBtn')?.addEventListener('click', () => {
            const newName = document.getElementById('editNameInput').value.trim();
            if (newName) userRef.update({ name: newName });
        });

        // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç–∞–≤–∫–∏
        window.updateUIbalance = updateUIbalance;
        setInterval(updateUIbalance, 5000);
    })();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ GAMES MODULE [2/4]</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #03030a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #f0f0fa;
        }

        #app {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 850px;
            background: #080812;
            border-radius: 40px;
            overflow: hidden;
            border: 1px solid #202036;
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a44 inset;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 24px 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #2a2a4a #080812;
            position: absolute;
            top: 0;
            left: 0;
            background: #080812;
            transition: opacity 0.25s ease;
        }

        .screen.active {
            display: flex;
            position: relative;
            z-index: 10;
        }

        /* –ù–µ–æ–Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ */
        :root {
            --neon-blue: #4b6bff;
            --neon-cyan: #3bd9d9;
            --neon-red: #ff4b6b;
            --dark-bg: #080812;
            --card-bg: #0c0c1a;
            --border-dim: #25253f;
        }

        .text-blue { color: var(--neon-blue); }
        .text-cyan { color: var(--neon-cyan); }
        .text-red { color: var(--neon-red); }
        .bg-card { background: var(--card-bg); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: #121222;
            border: 1px solid #2a2a48;
            color: #f0f0ff;
            padding: 16px 0;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.2, 0.9, 0.3, 1);
            cursor: pointer;
            letter-spacing: 0.3px;
        }

        .btn:active {
            background: #1c1c34;
            border-color: var(--neon-blue);
            transform: scale(0.98);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        .btn-neon {
            background: #1a1a2e;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(75, 107, 255, 0.3);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-dim);
            border-radius: 28px;
            padding: 20px;
            transition: all 0.2s;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 0 16px;
            scrollbar-width: none;
        }

        .nav-btn {
            background: #0f0f1f;
            border: 1px solid #2a2a48;
            padding: 10px 20px;
            border-radius: 40px;
            font-size: 15px;
            white-space: nowrap;
            color: #b0b0da;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: #1a1a34;
            border-color: var(--neon-blue);
            color: white;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* –°–µ—Ç–∫–∞ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin: 16px 0;
        }

        /* –ê–≤–∞—Ç–∞—Ä */
        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 64px;
            background: linear-gradient(145deg, #1a1a30, #0a0a18);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        /* –ò–Ω–ø—É—Ç—ã */
        .input-field {
            background: #0a0a18;
            border: 1px solid #2a2a48;
            border-radius: 40px;
            padding: 16px 24px;
            font-size: 16px;
            color: white;
            width: 100%;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* –ü–æ–ª–µ –º–∏–Ω 3x3 */
        .mines-field {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .mine-cell {
            aspect-ratio: 1/1;
            background: #0d0d1d;
            border: 1px solid #2d2d4a;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 600;
            color: #e0e0ff;
            transition: all 0.15s ease;
            cursor: pointer;
            box-shadow: 0 4px 0 #00000060;
        }

        .mine-cell:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .mine-cell.revealed {
            background: #1a1a32;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .mine-cell.mine {
            background: #2a0a0a;
            border-color: var(--neon-red);
            color: #ff8b8b;
            box-shadow: 0 0 25px var(--neon-red);
        }

        .mine-cell.safe {
            background: #0a2a1a;
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            box-shadow: 0 0 20px var(--neon-cyan);
        }

        /* –ú–æ–Ω–µ—Ç–∞ */
        .coin-container {
            perspective: 1000px;
            margin: 20px auto;
            width: 120px;
            height: 120px;
        }

        .coin {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.3, 1);
        }

        .coin.flip {
            transform: rotateY(720deg);
        }

        .coin-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            backface-visibility: hidden;
            background: radial-gradient(circle at 30% 30%, #ffffb0, #d4af37);
            border: 2px solid gold;
            box-shadow: 0 0 30px gold;
        }

        .coin-face.tail {
            transform: rotateY(180deg);
        }

        /* –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å */
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
            display: inline-block;
        }
        .offline-dot {
            background: #5a5a88;
            box-shadow: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* –ú–Ω–æ–∂–∏—Ç–µ–ª—å */
        .multiplier-badge {
            background: #1a1a2e;
            border: 1px solid var(--neon-cyan);
            border-radius: 40px;
            padding: 8px 16px;
            display: inline-block;
            color: var(--neon-cyan);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ========== –•–ê–ë ========== -->
        <div id="mainHub" class="screen">
            <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h1 style="font-size: 32px; font-weight: 600; letter-spacing: -0.5px;">
                    <span style="color: var(--neon-blue);">DUELS</span>
                </h1>
                <div style="display: flex; gap: 8px; align-items: center; background: #0f0f21; padding: 8px 18px; border-radius: 40px; border: 1px solid #2a2a4a;">
                    <span style="color: var(--neon-cyan); font-weight: 600;" id="hubBalance">0</span>
                    <span style="color: var(--neon-cyan);">‚≠ê</span>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å –º–∏–Ω–∏ -->
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 28px;">
                <div class="avatar"></div>
                <div>
                    <div style="font-size: 22px; font-weight: 500;" id="hubPlayerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="display: flex; gap: 8px; margin-top: 4px; color: #a0a0d0;">
                        <span class="online-dot"></span>
                        <span>–≤ —Å–µ—Ç–∏</span>
                    </div>
                </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="nav-row">
                <div class="nav-btn" data-screen="mainHub">–•–∞–±</div>
                <div class="nav-btn" data-screen="gamesScreen">–ò–≥—Ä—ã</div>
                <div class="nav-btn" data-screen="profileScreen">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="nav-btn" data-screen="shopScreen">–ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="nav-btn" data-screen="onlineLobby">PvP</div>
                <div class="nav-btn" data-screen="settingsScreen">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>

            <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
            <div style="margin: 16px 0 8px;">
                <h3 style="color: #b0b0e0;">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</h3>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä -->
            <div class="grid-2">
                <div class="card" style="padding: 18px;" data-game="coin">
                    <div style="font-size: 36px; margin-bottom: 8px;">ü™ô</div>
                    <div style="font-weight: 500;">–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x2</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="mines">
                    <div style="font-size: 36px; margin-bottom: 8px;">üí£</div>
                    <div style="font-weight: 500;">–ú–∏–Ω—ã 3x3</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x5 –º–∞–∫—Å</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="rps">
                    <div style="font-size: 36px; margin-bottom: 8px;">‚úÇÔ∏è</div>
                    <div style="font-weight: 500;">RPS</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">vs –±–æ—Ç</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="roulette">
                    <div style="font-size: 36px; margin-bottom: 8px;">üé∞</div>
                    <div style="font-weight: 500;">–†—É–ª–µ—Ç–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x14</div>
                </div>
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏ -->
            <div class="card" style="margin-top: 12px;">
                <div style="display: flex; justify-content: space-between;">
                    <span>–ê–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏</span>
                    <span class="text-cyan" id="activeRoomsCount">0</span>
                </div>
            </div>
        </div>

        <!-- ========== –≠–ö–†–ê–ù –ò–ì–† ========== -->
        <div id="gamesScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–í—Å–µ –∏–≥—Ä—ã</h2>
            </div>

            <div class="grid-2">
                <div class="card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                <div class="card" data-game="mines">üí£ –ú–∏–Ω—ã 3x3</div>
                <div class="card" data-game="rps">‚úÇÔ∏è –ö–ù–ë</div>
                <div class="card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
                <div class="card" data-game="pvp">‚öîÔ∏è PvP –∞—Ä–µ–Ω–∞</div>
            </div>
        </div>

        <!-- ========== –ü–†–û–§–ò–õ–¨ ========== -->
        <div id="profileScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                <div class="avatar" style="width: 100px; height: 100px; margin-bottom: 16px;"></div>
                <div style="font-size: 26px; font-weight: 500;" id="profileName">‚Äî</div>
                <div style="color: #8080b0; font-size: 14px; margin-top: 4px;" id="profileUid">‚Äî</div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–ë–∞–ª–∞–Ω—Å</span>
                    <span><span class="text-cyan" id="profileBalance">0</span> ‚≠ê</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–°—Ç–∞—Ç—É—Å</span>
                    <span><span id="profileStatus" class="online-dot"></span> –æ–Ω–ª–∞–π–Ω</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                    <span id="profileCreated">‚Äî</span>
                </div>
            </div>

            <h3 style="margin-bottom: 12px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
            <div style="display: flex; gap: 12px;">
                <input type="text" id="editNameInput" class="input-field" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
                <div class="btn btn-neon" style="width: 80px; padding: 16px;" id="saveNameBtn">OK</div>
            </div>
        </div>

        <!-- ========== –ú–ê–ì–ê–ó–ò–ù ========== -->
        <div id="shopScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ú–∞–≥–∞–∑–∏–Ω</h2>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">Telegram Stars</h3>
                <div class="grid-2">
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(100)">
                        <div style="font-size: 24px;">‚≠ê 100</div>
                        <div class="text-cyan">+100</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(500)">
                        <div style="font-size: 24px;">‚≠ê 500</div>
                        <div class="text-cyan">+500</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(1000)">
                        <div style="font-size: 24px;">‚≠ê 1000</div>
                        <div class="text-cyan">+1000</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(2500)">
                        <div style="font-size: 24px;">‚≠ê 2500</div>
                        <div class="text-cyan">+2500</div>
                    </div>
                </div>
                <div style="margin-top: 24px; text-align: center; color: #b0b0e0;">
                    –í–∞—à –±–∞–ª–∞–Ω—Å: <span class="text-cyan" id="shopBalance">0</span> ‚≠ê
                </div>
            </div>
        </div>

        <!-- ========== PvP –õ–û–ë–ë–ò ========== -->
        <div id="onlineLobby" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">PvP –ª–æ–±–±–∏</h2>
            </div>

            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; background: #0c0c1e; padding: 16px; border-radius: 28px;">
                <span>–û–Ω–ª–∞–π–Ω: <span class="text-cyan" id="lobbyCounter">0</span></span>
                <div class="btn btn-neon" style="padding: 10px 24px;" onclick="window.createRoom()">+ –°–æ–∑–¥–∞—Ç—å</div>
            </div>

            <div id="roomsContainer"></div>
        </div>

        <!-- ========== –ù–ê–°–¢–†–û–ô–ö–ò ========== -->
        <div id="settingsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            <div class="card">
                <div style="margin-bottom: 20px;">‚öôÔ∏è –ó–≤—É–∫: –≤–∫–ª/–≤—ã–∫–ª</div>
                <div>üé® –¢–µ–º–∞: —Ç—ë–º–Ω–∞—è (–Ω–µ–æ–Ω)</div>
            </div>
        </div>

        <!-- ========== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –≠–ö–†–ê–ù –ò–ì–†–´ ========== -->
        <div id="gameDynamicScreen" class="screen"></div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== –ß–ê–°–¢–¨ 2/4: –ò–ì–†–´ (–û–†–Å–õ –ò –†–ï–®–ö–ê + –ú–ò–ù–´ 3x3) ====================
        
        (function() {
            // ===== FIREBASE =====
            const firebaseConfig = {
                apiKey: "AIzaSyDummy123456789",
                authDomain: "duels-neon.firebaseapp.com",
                databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
                projectId: "duels-neon",
            };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();

            // ===== UID =====
            const tg = window.Telegram?.WebApp || { initDataUnsafe: { user: { id: 12345678 } } };
            const tgUser = tg.initDataUnsafe?.user;
            let UID = localStorage.getItem('duels_uid');
            
            if (!UID) {
                if (tgUser) {
                    UID = 'tg_' + tgUser.id;
                } else {
                    UID = 'local_' + Math.random().toString(36).substring(2, 10);
                }
                localStorage.setItem('duels_uid', UID);
            }

            // ===== –°–°–´–õ–ö–ò =====
            const userRef = db.ref('users/' + UID);
            const logsRef = db.ref('logs/' + UID);
            const gamesRef = db.ref('games');

            // ===== –ë–ê–õ–ê–ù–° =====
            async function addStars(amount) {
                let newBal = 0;
                await userRef.child('balance').transaction(b => {
                    newBal = (b || 0) + amount;
                    return newBal;
                });
                updateBalanceUI();
                return newBal;
            }

            async function removeStars(amount) {
                let success = false;
                await userRef.child('balance').transaction(b => {
                    if (b >= amount) {
                        success = true;
                        return b - amount;
                    }
                    return b;
                });
                updateBalanceUI();
                return success;
            }

            async function getBalance() {
                const snap = await userRef.child('balance').once('value');
                return snap.val() || 0;
            }

            async function updateBalanceUI() {
                const bal = await getBalance();
                document.querySelectorAll('#hubBalance, #profileBalance, #shopBalance').forEach(el => {
                    if (el) el.innerText = bal;
                });
            }

            // ===== –õ–û–ì–ò =====
            function addLog(game, bet, result) {
                logsRef.push({
                    game: game,
                    bet: bet,
                    result: result,
                    time: Date.now()
                });
            }

            // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.once('value', (snap) => {
                if (!snap.exists()) {
                    userRef.set({
                        name: 'Player_' + UID.substring(0, 5),
                        avatar: '',
                        balance: 1000,
                        online: true,
                        lastSeen: Date.now(),
                        created: Date.now()
                    });
                }
            });

            // ===== –û–ù–õ–ê–ô–ù –°–¢–ê–¢–£–° =====
            function pingOnline() {
                userRef.update({ 
                    online: true, 
                    lastSeen: Date.now() 
                });
            }
            
            pingOnline();
            setInterval(pingOnline, 20000);
            
            window.addEventListener('beforeunload', () => {
                userRef.update({ 
                    online: false, 
                    lastSeen: Date.now() 
                });
            });

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.on('value', (snap) => {
                const data = snap.val() || {};
                
                document.getElementById('hubPlayerName').innerText = data.name || '‚Äî';
                document.getElementById('profileName').innerText = data.name || '‚Äî';
                document.getElementById('profileUid').innerText = UID;
                document.getElementById('profileBalance').innerText = data.balance || 0;
                document.getElementById('hubBalance').innerText = data.balance || 0;
                document.getElementById('shopBalance').innerText = data.balance || 0;
                
                const created = data.created ? new Date(data.created).toLocaleDateString() : '‚Äî';
                document.getElementById('profileCreated').innerText = created;
                
                const statusDot = document.getElementById('profileStatus');
                if (data.online) {
                    statusDot.className = 'online-dot';
                } else {
                    statusDot.className = 'offline-dot';
                }
            });

            // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
            window.showScreen = function(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-screen') === screenId) {
                        btn.classList.add('active');
                    }
                });

                if (screenId === 'onlineLobby') {
                    renderLobby();
                }
            };

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const screenId = btn.getAttribute('data-screen');
                    if (screenId) showScreen(screenId);
                });
            });

            // ===== –ó–ê–ì–†–£–ó–ö–ê –ò–ì–† =====
            window.loadGameScreen = function(gameId) {
                const container = document.getElementById('gameDynamicScreen');
                let html = '';
                
                switch(gameId) {
                    case 'coin':
                        html = renderCoin();
                        break;
                    case 'mines':
                        html = renderMines();
                        break;
                    default:
                        alert(`–ò–≥—Ä–∞ ${gameId} –±—É–¥–µ—Ç –≤ —á–∞—Å—Ç–∏ 3`);
                        return;
                }
                
                container.innerHTML = html;
                showScreen('gameDynamicScreen');
                attachGameLogic(gameId);
            };

            // ===== –†–ï–ù–î–ï–† –û–†–Å–õ –ò –†–ï–®–ö–ê =====
            function renderCoin() {
                return `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                        <h2 style="font-size: 26px;">–û—Ä—ë–ª –∏ –†–µ—à–∫–∞</h2>
                    </div>
                    
                    <div class="card" style="text-align: center;">
                        <div class="coin-container">
                            <div class="coin" id="coin">
                                <div class="coin-face">ü¶Ö</div>
                                <div class="coin-face tail">üíÄ</div>
                            </div>
                        </div>
                        
                        <div style="margin: 24px 0 16px;">
                            <div class="multiplier-badge">x2</div>
                        </div>
                        
                        <input type="number" id="betCoin" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞" value="10" min="1" style="margin-bottom: 16px;">
                        
                        <div class="btn btn-neon" style="margin-bottom: 16px;" id="playCoin">–ë—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç—É</div>
                        
                        <div id="coinMessage" style="min-height: 40px; font-size: 18px; color: var(--neon-cyan);"></div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 20px; color: #a0a0c0;">
                            <span>–®–∞–Ω—Å: 50%</span>
                            <span>–ú–∞–∫—Å: 500‚≠ê</span>
                        </div>
                    </div>
                `;
            }

            // ===== –†–ï–ù–î–ï–† –ú–ò–ù–´ 3x3 =====
            function renderMines() {
                return `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                        <h2 style="font-size: 26px;">–ú–∏–Ω—ã 3x3</h2>
                    </div>
                    
                    <div class="card">
                        <div class="mines-field" id="minesField">
                            ${Array(9).fill(0).map((_, i) => `<div class="mine-cell" data-index="${i}">?</div>`).join('')}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 16px 0;">
                            <span class="multiplier-badge" id="minesMultiplier">1.0x</span>
                            <span style="color: #a0a0c0;">–ë–æ–º–±: 2</span>
                        </div>
                        
                        <input type="number" id="betMines" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞" value="10" min="1" style="margin-bottom: 16px;">
                        
                        <div class="btn" style="margin-bottom: 12px;" id="resetMines">–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                        <div class="btn btn-neon" id="cashoutMines">–ó–∞–±—Ä–∞—Ç—å (0‚≠ê)</div>
                        
                        <div id="minesMessage" style="text-align: center; margin-top: 16px; min-height: 40px;"></div>
                    </div>
                `;
            }

            // ===== –õ–û–ì–ò–ö–ê –ò–ì–† =====
            function attachGameLogic(gameId) {
                if (gameId === 'coin') {
                    document.getElementById('playCoin').addEventListener('click', async () => {
                        const bet = parseInt(document.getElementById('betCoin').value);
                        const coin = document.getElementById('coin');
                        
                        if (bet < 1 || bet > 500) {
                            document.getElementById('coinMessage').innerText = '‚ùå –°—Ç–∞–≤–∫–∞ –æ—Ç 1 –¥–æ 500';
                            return;
                        }
                        
                        // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
                        const success = await removeStars(bet);
                        if (!success) {
                            document.getElementById('coinMessage').innerText = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
                            return;
                        }
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è
                        coin.classList.add('flip');
                        
                        setTimeout(async () => {
                            coin.classList.remove('flip');
                            
                            const isWin = Math.random() < 0.5;
                            
                            if (isWin) {
                                await addStars(bet * 2);
                                document.getElementById('coinMessage').innerHTML = 'ü¶Ö <span style="color: #3bd9d9;">–ü–û–ë–ï–î–ê! +' + bet + '‚≠ê</span>';
                                addLog('coin', bet, 'win');
                            } else {
                                document.getElementById('coinMessage').innerHTML = 'üíÄ <span style="color: #ff4b6b;">–ü–†–û–ò–ì–†–´–® -' + bet + '‚≠ê</span>';
                                addLog('coin', bet, 'lose');
                            }
                        }, 600);
                    });
                }
                
                if (gameId === 'mines') {
                    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                    let board = [];
                    let mines = []; // –∏–Ω–¥–µ–∫—Å—ã –º–∏–Ω
                    let revealed = [];
                    let gameActive = true;
                    let currentMultiplier = 1.0;
                    let betAmount = 10;
                    
                    function initMines() {
                        // 2 –º–∏–Ω—ã –≤ 3x3 (22.2%)
                        mines = [];
                        while(mines.length < 2) {
                            const pos = Math.floor(Math.random() * 9);
                            if (!mines.includes(pos)) mines.push(pos);
                        }
                        
                        board = Array(9).fill('safe');
                        mines.forEach(i => board[i] = 'mine');
                        revealed = Array(9).fill(false);
                        gameActive = true;
                        currentMultiplier = 1.0;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º UI
                        document.querySelectorAll('#minesField .mine-cell').forEach((cell, i) => {
                            cell.innerText = '?';
                            cell.className = 'mine-cell';
                        });
                        
                        document.getElementById('minesMultiplier').innerText = currentMultiplier.toFixed(1) + 'x';
                        document.getElementById('cashoutMines').innerText = `–ó–∞–±—Ä–∞—Ç—å (0‚≠ê)`;
                        document.getElementById('minesMessage').innerText = '';
                    }
                    
                    // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
                    document.querySelectorAll('#minesField .mine-cell').forEach(cell => {
                        cell.addEventListener('click', async () => {
                            if (!gameActive) return;
                            
                            const index = parseInt(cell.getAttribute('data-index'));
                            if (revealed[index]) return;
                            
                            // –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫? –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞–≤–∫—É
                            if (revealed.filter(r => r).length === 0) {
                                betAmount = parseInt(document.getElementById('betMines').value);
                                if (betAmount < 1) {
                                    document.getElementById('minesMessage').innerText = '‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É';
                                    return;
                                }
                                
                                // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ö–æ–¥–µ
                                const success = await removeStars(betAmount);
                                if (!success) {
                                    document.getElementById('minesMessage').innerText = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
                                    return;
                                }
                            }
                            
                            revealed[index] = true;
                            
                            if (board[index] === 'mine') {
                                // –ü—Ä–æ–∏–≥—Ä—ã—à
                                cell.className = 'mine-cell mine';
                                cell.innerText = 'üí£';
                                gameActive = false;
                                document.getElementById('minesMessage').innerHTML = '<span style="color: #ff4b6b;">üí• –ë–û–ú–ë–ê! –ü—Ä–æ–∏–≥—Ä—ã—à</span>';
                                addLog('mines', betAmount, 'lose');
                            } else {
                                // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–ª–µ—Ç–∫–∞
                                cell.className = 'mine-cell safe';
                                cell.innerText = '‚≠ê';
                                
                                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å (
  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ GAMES MODULE [3/4]</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #03030a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #f0f0fa;
        }

        #app {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 850px;
            background: #080812;
            border-radius: 40px;
            overflow: hidden;
            border: 1px solid #202036;
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a44 inset;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 24px 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #2a2a4a #080812;
            position: absolute;
            top: 0;
            left: 0;
            background: #080812;
            transition: opacity 0.25s ease;
        }

        .screen.active {
            display: flex;
            position: relative;
            z-index: 10;
        }

        /* –ù–µ–æ–Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ */
        :root {
            --neon-blue: #4b6bff;
            --neon-cyan: #3bd9d9;
            --neon-red: #ff4b6b;
            --neon-green: #4bff8c;
            --neon-yellow: #ffd966;
            --dark-bg: #080812;
            --card-bg: #0c0c1a;
            --border-dim: #25253f;
        }

        .text-blue { color: var(--neon-blue); }
        .text-cyan { color: var(--neon-cyan); }
        .text-red { color: var(--neon-red); }
        .text-green { color: var(--neon-green); }
        .bg-card { background: var(--card-bg); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: #121222;
            border: 1px solid #2a2a48;
            color: #f0f0ff;
            padding: 16px 0;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.2, 0.9, 0.3, 1);
            cursor: pointer;
            letter-spacing: 0.3px;
        }

        .btn:active {
            background: #1c1c34;
            border-color: var(--neon-blue);
            transform: scale(0.98);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        .btn-neon {
            background: #1a1a2e;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(75, 107, 255, 0.3);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-dim);
            border-radius: 28px;
            padding: 20px;
            transition: all 0.2s;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 0 16px;
            scrollbar-width: none;
        }

        .nav-btn {
            background: #0f0f1f;
            border: 1px solid #2a2a48;
            padding: 10px 20px;
            border-radius: 40px;
            font-size: 15px;
            white-space: nowrap;
            color: #b0b0da;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: #1a1a34;
            border-color: var(--neon-blue);
            color: white;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* –°–µ—Ç–∫–∞ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin: 16px 0;
        }

        /* –ê–≤–∞—Ç–∞—Ä */
        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 64px;
            background: linear-gradient(145deg, #1a1a30, #0a0a18);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        /* –ò–Ω–ø—É—Ç—ã */
        .input-field {
            background: #0a0a18;
            border: 1px solid #2a2a48;
            border-radius: 40px;
            padding: 16px 24px;
            font-size: 16px;
            color: white;
            width: 100%;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .roulette-wheel {
            background: #0a0a1a;
            border-radius: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 700;
            border: 2px solid #2a2a4a;
            margin: 20px 0;
            transition: all 0.3s cubic-bezier(0.1, 0.9, 0.2, 1);
            color: #f0f0ff;
            text-shadow: 0 0 10px currentColor;
        }

        .roulette-wheel.spinning {
            border-color: var(--neon-blue);
            box-shadow: 0 0 40px var(--neon-blue);
            transform: scale(1.02);
            color: white;
        }

        .roulette-wheel.red { color: #ff4b6b; }
        .roulette-wheel.black { color: #b0b0ff; }
        .roulette-wheel.green { color: #4bff8c; }

        .bet-option {
            background: #0f0f1f;
            border: 1px solid #2f2f4f;
            border-radius: 40px;
            padding: 14px 24px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .bet-option.active {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
            background: #1a1a32;
        }

        .bet-option.red.active { border-color: #ff4b6b; box-shadow: 0 0 20px #ff4b6b; }
        .bet-option.black.active { border-color: #b0b0ff; box-shadow: 0 0 20px #b0b0ff; }
        .bet-option.green.active { border-color: #4bff8c; box-shadow: 0 0 20px #4bff8c; }

        /* RPS –∂–µ—Å—Ç—ã */
        .gesture-btn {
            background: #0f0f1f;
            border: 1px solid #2f2f4f;
            border-radius: 60px;
            padding: 20px;
            font-size: 36px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .gesture-btn:hover {
            border-color: var(--neon-blue);
            transform: translateY(-2px);
        }

        .gesture-btn.selected {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 25px var(--neon-cyan);
            background: #1a1a36;
        }

        /* –õ–æ–≥–∏ */
        .log-item {
            background: #0a0a16;
            border: 1px solid #2a2a40;
            border-radius: 20px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .log-win { color: var(--neon-green); }
        .log-lose { color: var(--neon-red); }
        .log-draw { color: var(--neon-yellow); }

        /* –ú–Ω–æ–∂–∏—Ç–µ–ª—å */
        .multiplier-badge {
            background: #1a1a2e;
            border: 1px solid var(--neon-cyan);
            border-radius: 40px;
            padding: 8px 16px;
            display: inline-block;
            color: var(--neon-cyan);
            font-weight: 600;
        }

        /* –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å */
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
            display: inline-block;
        }
        .offline-dot {
            background: #5a5a88;
            box-shadow: none;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-container {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ========== –•–ê–ë ========== -->
        <div id="mainHub" class="screen">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h1 style="font-size: 32px; font-weight: 600; letter-spacing: -0.5px;">
                    <span style="color: var(--neon-blue);">DUELS</span>
                </h1>
                <div style="display: flex; gap: 8px; align-items: center; background: #0f0f21; padding: 8px 18px; border-radius: 40px; border: 1px solid #2a2a4a;">
                    <span style="color: var(--neon-cyan); font-weight: 600;" id="hubBalance">0</span>
                    <span style="color: var(--neon-cyan);">‚≠ê</span>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 28px;">
                <div class="avatar"></div>
                <div>
                    <div style="font-size: 22px; font-weight: 500;" id="hubPlayerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="display: flex; gap: 8px; margin-top: 4px; color: #a0a0d0;">
                        <span class="online-dot"></span>
                        <span>–≤ —Å–µ—Ç–∏</span>
                    </div>
                </div>
            </div>

            <div class="nav-row">
                <div class="nav-btn" data-screen="mainHub">–•–∞–±</div>
                <div class="nav-btn" data-screen="gamesScreen">–ò–≥—Ä—ã</div>
                <div class="nav-btn" data-screen="profileScreen">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="nav-btn" data-screen="shopScreen">–ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="nav-btn" data-screen="onlineLobby">PvP</div>
                <div class="nav-btn" data-screen="settingsScreen">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="nav-btn" data-screen="logsScreen">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>

            <div style="margin: 16px 0 8px;">
                <h3 style="color: #b0b0e0;">–ò–≥—Ä—ã</h3>
            </div>

            <div class="grid-2">
                <div class="card" style="padding: 18px;" data-game="coin">
                    <div style="font-size: 36px; margin-bottom: 8px;">ü™ô</div>
                    <div style="font-weight: 500;">–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x2</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="mines">
                    <div style="font-size: 36px; margin-bottom: 8px;">üí£</div>
                    <div style="font-weight: 500;">–ú–∏–Ω—ã 3x3</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x5</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="rps">
                    <div style="font-size: 36px; margin-bottom: 8px;">‚úÇÔ∏è</div>
                    <div style="font-weight: 500;">RPS</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x2</div>
                </div>
                <div class="card" style="padding: 18px;" data-game="roulette">
                    <div style="font-size: 36px; margin-bottom: 8px;">üé∞</div>
                    <div style="font-weight: 500;">–†—É–ª–µ—Ç–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x14</div>
                </div>
            </div>
        </div>

        <!-- ========== –≠–ö–†–ê–ù –ò–ì–† ========== -->
        <div id="gamesScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–í—Å–µ –∏–≥—Ä—ã</h2>
            </div>

            <div class="grid-2">
                <div class="card" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                <div class="card" data-game="mines">üí£ –ú–∏–Ω—ã 3x3</div>
                <div class="card" data-game="rps">‚úÇÔ∏è RPS</div>
                <div class="card" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
                <div class="card" data-game="pvp">‚öîÔ∏è PvP –∞—Ä–µ–Ω–∞</div>
            </div>
        </div>

        <!-- ========== –ü–†–û–§–ò–õ–¨ ========== -->
        <div id="profileScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                <div class="avatar" style="width: 100px; height: 100px; margin-bottom: 16px;"></div>
                <div style="font-size: 26px; font-weight: 500;" id="profileName">‚Äî</div>
                <div style="color: #8080b0; font-size: 14px; margin-top: 4px;" id="profileUid">‚Äî</div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–ë–∞–ª–∞–Ω—Å</span>
                    <span><span class="text-cyan" id="profileBalance">0</span> ‚≠ê</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–°—Ç–∞—Ç—É—Å</span>
                    <span><span id="profileStatus" class="online-dot"></span> –æ–Ω–ª–∞–π–Ω</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                    <span id="profileCreated">‚Äî</span>
                </div>
            </div>

            <h3 style="margin-bottom: 12px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
            <div style="display: flex; gap: 12px;">
                <input type="text" id="editNameInput" class="input-field" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
                <div class="btn btn-neon" style="width: 80px; padding: 16px;" id="saveNameBtn">OK</div>
            </div>
        </div>

        <!-- ========== –ú–ê–ì–ê–ó–ò–ù ========== -->
        <div id="shopScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ú–∞–≥–∞–∑–∏–Ω</h2>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">Telegram Stars</h3>
                <div class="grid-2">
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(100)">
                        <div style="font-size: 24px;">‚≠ê 100</div>
                        <div class="text-cyan">+100</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(500)">
                        <div style="font-size: 24px;">‚≠ê 500</div>
                        <div class="text-cyan">+500</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(1000)">
                        <div style="font-size: 24px;">‚≠ê 1000</div>
                        <div class="text-cyan">+1000</div>
                    </div>
                    <div class="card" style="padding: 16px;" onclick="window.buyStars(2500)">
                        <div style="font-size: 24px;">‚≠ê 2500</div>
                        <div class="text-cyan">+2500</div>
                    </div>
                </div>
                <div style="margin-top: 24px; text-align: center; color: #b0b0e0;">
                    –í–∞—à –±–∞–ª–∞–Ω—Å: <span class="text-cyan" id="shopBalance">0</span> ‚≠ê
                </div>
            </div>
        </div>

        <!-- ========== PvP –õ–û–ë–ë–ò ========== -->
        <div id="onlineLobby" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">PvP –ª–æ–±–±–∏</h2>
            </div>

            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; background: #0c0c1e; padding: 16px; border-radius: 28px;">
                <span>–û–Ω–ª–∞–π–Ω: <span class="text-cyan" id="lobbyCounter">0</span></span>
                <div class="btn btn-neon" style="padding: 10px 24px;" onclick="window.createRoom()">+ –°–æ–∑–¥–∞—Ç—å</div>
            </div>

            <div id="roomsContainer"></div>
        </div>

        <!-- ========== –ù–ê–°–¢–†–û–ô–ö–ò ========== -->
        <div id="settingsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            <div class="card">
                <div style="margin-bottom: 20px;">‚öôÔ∏è –ó–≤—É–∫: –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                <div>üé® –¢–µ–º–∞: —Ç—ë–º–Ω–∞—è –Ω–µ–æ–Ω</div>
            </div>
        </div>

        <!-- ========== –ò–°–¢–û–†–ò–Ø –ò–ì–† (–õ–û–ì–ò) ========== -->
        <div id="logsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h2>
            </div>

            <div class="card" style="padding: 16px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px; color: #a0a0c0;">
                    <span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∏–≥—Ä</span>
                    <span class="text-cyan" id="statsTotal">0‚≠ê</span>
                </div>
                <div id="logsContainer" class="history-container">
                    <!-- –õ–æ–≥–∏ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –∏–∑ Firebase -->
                </div>
            </div>
        </div>

        <!-- ========== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –≠–ö–†–ê–ù –ò–ì–†–´ ========== -->
        <div id="gameDynamicScreen" class="screen"></div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== –ß–ê–°–¢–¨ 3/4: –†–£–õ–ï–¢–ö–ê, RPS, –õ–û–ì–ò ====================
        
        (function() {
            // ===== FIREBASE =====
            const firebaseConfig = {
                apiKey: "AIzaSyDummy123456789",
                authDomain: "duels-neon.firebaseapp.com",
                databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
                projectId: "duels-neon",
            };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();

            // ===== UID =====
            const tg = window.Telegram?.WebApp || { initDataUnsafe: { user: { id: 12345678 } } };
            const tgUser = tg.initDataUnsafe?.user;
            let UID = localStorage.getItem('duels_uid');
            
            if (!UID) {
                if (tgUser) {
                    UID = 'tg_' + tgUser.id;
                } else {
                    UID = 'local_' + Math.random().toString(36).substring(2, 10);
                }
                localStorage.setItem('duels_uid', UID);
            }

            // ===== –°–°–´–õ–ö–ò =====
            const userRef = db.ref('users/' + UID);
            const logsRef = db.ref('logs/' + UID);

            // ===== –ë–ê–õ–ê–ù–° =====
            async function addStars(amount) {
                let newBal = 0;
                await userRef.child('balance').transaction(b => {
                    newBal = (b || 0) + amount;
                    return newBal;
                });
                updateBalanceUI();
                return newBal;
            }

            async function removeStars(amount) {
                let success = false;
                await userRef.child('balance').transaction(b => {
                    if (b >= amount) {
                        success = true;
                        return b - amount;
                    }
                    return b;
                });
                updateBalanceUI();
                return success;
            }

            async function getBalance() {
                const snap = await userRef.child('balance').once('value');
                return snap.val() || 0;
            }

            async function updateBalanceUI() {
                const bal = await getBalance();
                document.querySelectorAll('#hubBalance, #profileBalance, #shopBalance').forEach(el => {
                    if (el) el.innerText = bal;
                });
            }

            // ===== –õ–û–ì–ò =====
            function addLog(game, bet, result) {
                logsRef.push({
                    game: game,
                    bet: bet,
                    result: result,
                    time: Date.now()
                });
            }

            // ===== –ó–ê–ì–†–£–ó–ö–ê –õ–û–ì–û–í =====
            async function loadLogs() {
                const snap = await logsRef.limitToLast(20).once('value');
                const logs = [];
                snap.forEach(child => logs.push({ id: child.key, ...child.val() }));
                
                const container = document.getElementById('logsContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (logs.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #8080b0; padding: 20px;">–ù–µ—Ç –∏–≥—Ä</div>';
                    return;
                }
                
                let totalProfit = 0;
                
                logs.reverse().forEach(log => {
                    const date = new Date(log.time).toLocaleTimeString();
                    const profit = log.result === 'win' ? log.bet : (log.result === 'draw' ? 0 : -log.bet);
                    totalProfit += profit;
                    
                    const div = document.createElement('div');
                    div.className = 'log-item';
                    
                    let resultClass = 'log-' + log.result;
                    let resultSymbol = log.result === 'win' ? '‚úÖ' : (log.result === 'draw' ? 'üîÑ' : '‚ùå');
                    
                    div.innerHTML = `
                        <div>
                            <span style="font-weight: 600;">${getGameIcon(log.game)} ${log.game}</span>
                            <span style="color: #8080b0; margin-left: 8px;">${date}</span>
                        </div>
                        <div>
                            <span class="${resultClass}">${resultSymbol} ${log.bet}‚≠ê</span>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
                
                document.getElementById('statsTotal').innerText = (totalProfit > 0 ? '+' : '') + totalProfit + '‚≠ê';
            }

            function getGameIcon(game) {
                const icons = {
                    'coin': 'ü™ô',
                    'mines': 'üí£',
                    'rps': '‚úÇÔ∏è',
                    'roulette': 'üé∞',
                    'pvp': '‚öîÔ∏è',
                    'stars_purchase': '‚≠ê'
                };
                return icons[game] || 'üéÆ';
            }

            // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.once('value', (snap) => {
                if (!snap.exists()) {
                    userRef.set({
                        name: 'Player_' + UID.substring(0, 5),
                        avatar: '',
                        balance: 1000,
                        online: true,
                        lastSeen: Date.now(),
                        created: Date.now()
                    });
                }
            });

            // ===== –û–ù–õ–ê–ô–ù –°–¢–ê–¢–£–° =====
            function pingOnline() {
                userRef.update({ online: true, lastSeen: Date.now() });
            }
            
            pingOnline();
            setInterval(pingOnline, 20000);
            
            window.addEventListener('beforeunload', () => {
                userRef.update({ online: false, lastSeen: Date.now() });
            });

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.on('value', (snap) => {
                const data = snap.val() || {};
                
                document.getElementById('hubPlayerName').innerText = data.name || '‚Äî';
                document.getElementById('profileName').innerText = data.name || '‚Äî';
                document.getElementById('profileUid').innerText = UID;
                document.getElementById('profileBalance').innerText = data.balance || 0;
                document.getElementById('hubBalance').innerText = data.balance || 0;
                document.getElementById('shopBalance').innerText = data.balance || 0;
                
                const created = data.created ? new Date(data.created).toLocaleDateString() : '‚Äî';
                document.getElementById('profileCreated').innerText = created;
                
                const statusDot = document.getElementById('profileStatus');
                if (data.online) {
                    statusDot.className = 'online-dot';
                } else {
                    statusDot.className = 'offline-dot';
                }
            });

            // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
            window.showScreen = function(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-screen') === screenId) {
                        btn.classList.add('active');
                    }
                });

                if (screenId === 'onlineLobby') renderLobby();
                if (screenId === 'logsScreen') loadLogs();
            };

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const screenId = btn.getAttribute('data-screen');
                    if (screenId) showScreen(screenId);
                });
            });

            // ===== –ó–ê–ì–†–£–ó–ö–ê –ò–ì–† =====
            window.loadGameScreen = function(gameId) {
                const container = document.getElementById('gameDynamicScreen');
                let html = '';
                
                switch(gameId) {
                    case 'coin':
                        html = renderCoin();
                        break;
                    case 'mines':
                        html = renderMines();
                        break;
                    case 'rps':
                        html = renderRPS();
                        break;
                    case 'roulette':
                        html = renderRoulette();
                        break;
                    default:
                        alert(`–ò–≥—Ä–∞ ${gameId} –±—É–¥–µ—Ç –≤ —á–∞—Å—Ç–∏ 4`);
                        return;
                }
                
                container.innerHTML = html;
                showScreen('gameDynamicScreen');
                attachGameLogic(gameId);
            };

            document.querySelectorAll('[data-game]').forEach(card => {
                card.addEventListener('click', () => {
                    const game = card.getAttribute('data-game');
                    if (game === 'pvp') {
                        showScreen('onlineLobby');
                    } else {
                        loadGameScreen(game);
                    }
                });
            });

            // ===== –†–ï–ù–î–ï–† –ò–ì–† =====
            function renderCoin() {
                return `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                        <h2 style="font-size: 26px;">–û—Ä—ë–ª –∏ –†–µ—à–∫–∞</h2>
                    </div>
                    
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 100px; margin: 20px 0; transition: all 0.3s;" id="coinResult">ü™ô</div>
                        
                        <div class="multiplier-badge" style="margin-bottom: 20px;">x2</div>
                        
                        <input type="number" id="betCoin" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞" value="10" min="1" max="1000" style="margin-bottom: 16px;">
                        
                        <div class="btn btn-neon" style="margin-bottom: 16px;" id="playCoin">–ë—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç—É</div>
                        
                        <div id="coinMessage" style="min-height: 40px; font-size: 18px;"></div>
                    </div>
                `;
            }

            function renderMines() {
                return `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                        <h2 style="font-size: 26px;">–ú–∏–Ω—ã 3x3</h2>
                    </div>
                    
                    <div class="card">
                        <div class="mines-field" id="minesField">
                            ${Array(9).fill(0).map((_, i) => `<div class="mine-cell" data-index="${i}">?</div>`).join('')}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 16px 0;">
                            <span class="multiplier-badge" id="minesMultiplier">1.0x</span>
                            <span style="color: #a0a0c0;">–ë–æ–º–±: 2</span>
                        </div>
                        
                        <input type="number" id="betMines" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞" value="10" min="1" style="margin-bottom: 16px;">
                        
                        <div class="btn" style="margin-bottom: 12px;" id="resetMines">–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                        <div class="btn btn-neon" id="cashoutMines">–ó–∞–±—Ä–∞—Ç—å (0‚≠ê)</div>
                        
                        <div id="minesMessage" style="text-align: center; margin-top: 16px;"></div>
                    </div>
                `;
            }

            function renderRPS() {
                return `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                        <h2 style="font-size: 26px;">–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</h2>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; gap: 12px; justify-content: center; margin: 20px 0;">
                            <div class="gesture-btn" data-rps="rock">ü™®</div>
                            <div class="gesture-btn" data-rps="paper">üìÑ</div>
                            <div class="gesture-btn" data-rps="scissors">‚úÇÔ∏è</div>
                        </div>
                        
                        <div class="multiplier-badge" style="margin: 0 auto 20px; display
                        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUELS ¬∑ FINAL [4/4] ¬∑ NEON ARENA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #03030a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #f0f0fa;
        }

        #app {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 850px;
            background: #080812;
            border-radius: 40px;
            overflow: hidden;
            border: 1px solid #202036;
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a44 inset;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding: 24px 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #2a2a4a #080812;
            position: absolute;
            top: 0;
            left: 0;
            background: #080812;
            transition: opacity 0.25s ease;
        }

        .screen.active {
            display: flex;
            position: relative;
            z-index: 10;
        }

        /* –ù–µ–æ–Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ */
        :root {
            --neon-blue: #4b6bff;
            --neon-cyan: #3bd9d9;
            --neon-red: #ff4b6b;
            --neon-green: #4bff8c;
            --neon-yellow: #ffd966;
            --neon-purple: #b84bff;
            --dark-bg: #080812;
            --card-bg: #0c0c1a;
            --border-dim: #25253f;
        }

        .text-blue { color: var(--neon-blue); }
        .text-cyan { color: var(--neon-cyan); }
        .text-red { color: var(--neon-red); }
        .text-green { color: var(--neon-green); }
        .text-purple { color: var(--neon-purple); }
        .bg-card { background: var(--card-bg); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: #121222;
            border: 1px solid #2a2a48;
            color: #f0f0ff;
            padding: 16px 0;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.2, 0.9, 0.3, 1);
            cursor: pointer;
            letter-spacing: 0.3px;
        }

        .btn:active {
            background: #1c1c34;
            border-color: var(--neon-blue);
            transform: scale(0.98);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        .btn-neon {
            background: #1a1a2e;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(75, 107, 255, 0.3);
        }

        .btn-red {
            border-color: var(--neon-red);
            color: var(--neon-red);
        }

        .btn-red:active {
            border-color: var(--neon-red);
            box-shadow: 0 0 25px var(--neon-red);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-dim);
            border-radius: 28px;
            padding: 20px;
            transition: all 0.2s;
        }

        .card-hover:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px var(--neon-cyan);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 0 16px;
            scrollbar-width: none;
        }

        .nav-btn {
            background: #0f0f1f;
            border: 1px solid #2a2a48;
            padding: 10px 20px;
            border-radius: 40px;
            font-size: 15px;
            white-space: nowrap;
            color: #b0b0da;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: #1a1a34;
            border-color: var(--neon-blue);
            color: white;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* –°–µ—Ç–∫–∞ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin: 16px 0;
        }

        /* –ê–≤–∞—Ç–∞—Ä */
        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 64px;
            background: linear-gradient(145deg, #1a1a30, #0a0a18);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        /* –ò–Ω–ø—É—Ç—ã */
        .input-field {
            background: #0a0a18;
            border: 1px solid #2a2a48;
            border-radius: 40px;
            padding: 16px 24px;
            font-size: 16px;
            color: white;
            width: 100%;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* PvP –∫–æ–º–Ω–∞—Ç–∞ */
        .room-item {
            background: #0a0a18;
            border: 1px solid #2a2a42;
            border-radius: 24px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .room-item:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px var(--neon-cyan);
        }

        .room-status {
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-waiting {
            background: #0a2a1a;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
        }

        .status-playing {
            background: #2a1a0a;
            border: 1px solid var(--neon-yellow);
            color: var(--neon-yellow);
        }

        /* –î—É—ç–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .duel-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
        }

        .duel-player {
            text-align: center;
            flex: 1;
        }

        .duel-vs {
            font-size: 24px;
            font-weight: 800;
            color: var(--neon-red);
            text-shadow: 0 0 15px var(--neon-red);
            margin: 0 10px;
        }

        .duel-avatar {
            width: 70px;
            height: 70px;
            border-radius: 70px;
            background: #121222;
            border: 2px solid var(--neon-blue);
            margin: 0 auto 10px;
        }

        .gesture-select {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .gesture-btn {
            background: #0f0f1f;
            border: 1px solid #2f2f4f;
            border-radius: 50px;
            padding: 15px 20px;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            text-align: center;
        }

        .gesture-btn:hover {
            border-color: var(--neon-blue);
            transform: translateY(-2px);
        }

        .gesture-btn.selected {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 25px var(--neon-cyan);
            background: #1a1a36;
        }

        .gesture-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* –õ–æ–≥–∏ */
        .log-item {
            background: #0a0a16;
            border: 1px solid #2a2a40;
            border-radius: 20px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .log-win { color: var(--neon-green); }
        .log-lose { color: var(--neon-red); }
        .log-draw { color: var(--neon-yellow); }

        /* –ú–Ω–æ–∂–∏—Ç–µ–ª—å */
        .multiplier-badge {
            background: #1a1a2e;
            border: 1px solid var(--neon-cyan);
            border-radius: 40px;
            padding: 8px 16px;
            display: inline-block;
            color: var(--neon-cyan);
            font-weight: 600;
        }

        /* –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å */
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
            display: inline-block;
        }
        .offline-dot {
            background: #5a5a88;
            box-shadow: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px var(--neon-blue); }
            50% { box-shadow: 0 0 30px var(--neon-blue); }
            100% { box-shadow: 0 0 10px var(--neon-blue); }
        }

        .glow {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ========== –•–ê–ë ========== -->
        <div id="mainHub" class="screen active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h1 style="font-size: 32px; font-weight: 600; letter-spacing: -0.5px;">
                    <span style="color: var(--neon-blue);">DUELS</span>
                </h1>
                <div style="display: flex; gap: 8px; align-items: center; background: #0f0f21; padding: 8px 18px; border-radius: 40px; border: 1px solid #2a2a4a;">
                    <span style="color: var(--neon-cyan); font-weight: 600;" id="hubBalance">0</span>
                    <span style="color: var(--neon-cyan);">‚≠ê</span>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 28px;">
                <div class="avatar"></div>
                <div>
                    <div style="font-size: 22px; font-weight: 500;" id="hubPlayerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="display: flex; gap: 8px; margin-top: 4px; color: #a0a0d0;">
                        <span class="online-dot"></span>
                        <span>–≤ —Å–µ—Ç–∏</span>
                    </div>
                </div>
            </div>

            <div class="nav-row">
                <div class="nav-btn active" data-screen="mainHub">–•–∞–±</div>
                <div class="nav-btn" data-screen="gamesScreen">–ò–≥—Ä—ã</div>
                <div class="nav-btn" data-screen="profileScreen">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="nav-btn" data-screen="shopScreen">–ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="nav-btn" data-screen="onlineLobby">PvP</div>
                <div class="nav-btn" data-screen="settingsScreen">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="nav-btn" data-screen="logsScreen">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>

            <div style="margin: 16px 0 8px;">
                <h3 style="color: #b0b0e0;">–ò–≥—Ä—ã</h3>
            </div>

            <div class="grid-2">
                <div class="card card-hover" style="padding: 18px;" data-game="coin">
                    <div style="font-size: 36px; margin-bottom: 8px;">ü™ô</div>
                    <div style="font-weight: 500;">–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x2</div>
                </div>
                <div class="card card-hover" style="padding: 18px;" data-game="mines">
                    <div style="font-size: 36px; margin-bottom: 8px;">üí£</div>
                    <div style="font-weight: 500;">–ú–∏–Ω—ã 3x3</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x5</div>
                </div>
                <div class="card card-hover" style="padding: 18px;" data-game="rps">
                    <div style="font-size: 36px; margin-bottom: 8px;">‚úÇÔ∏è</div>
                    <div style="font-weight: 500;">RPS</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x2</div>
                </div>
                <div class="card card-hover" style="padding: 18px;" data-game="roulette">
                    <div style="font-size: 36px; margin-bottom: 8px;">üé∞</div>
                    <div style="font-weight: 500;">–†—É–ª–µ—Ç–∫–∞</div>
                    <div style="color: var(--neon-cyan); font-size: 14px;">x14</div>
                </div>
            </div>

            <div class="card" style="margin-top: 12px; display: flex; justify-content: space-between;">
                <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥—É—ç–ª–µ–π</span>
                <span class="text-cyan" id="activeRoomsCount">0</span>
            </div>
        </div>

        <!-- ========== –≠–ö–†–ê–ù –ò–ì–† ========== -->
        <div id="gamesScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–í—Å–µ –∏–≥—Ä—ã</h2>
            </div>

            <div class="grid-2">
                <div class="card card-hover" data-game="coin">ü™ô –û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</div>
                <div class="card card-hover" data-game="mines">üí£ –ú–∏–Ω—ã 3x3</div>
                <div class="card card-hover" data-game="rps">‚úÇÔ∏è RPS</div>
                <div class="card card-hover" data-game="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
                <div class="card card-hover" data-game="pvp">‚öîÔ∏è PvP –∞—Ä–µ–Ω–∞</div>
            </div>
        </div>

        <!-- ========== –ü–†–û–§–ò–õ–¨ ========== -->
        <div id="profileScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                <div class="avatar" style="width: 100px; height: 100px; margin-bottom: 16px;"></div>
                <div style="font-size: 26px; font-weight: 500;" id="profileName">‚Äî</div>
                <div style="color: #8080b0; font-size: 14px; margin-top: 4px;" id="profileUid">‚Äî</div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–ë–∞–ª–∞–Ω—Å</span>
                    <span><span class="text-cyan" id="profileBalance">0</span> ‚≠ê</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <span>–°—Ç–∞—Ç—É—Å</span>
                    <span><span id="profileStatus" class="online-dot"></span> –æ–Ω–ª–∞–π–Ω</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                    <span id="profileCreated">‚Äî</span>
                </div>
            </div>

            <h3 style="margin-bottom: 12px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
            <div style="display: flex; gap: 12px;">
                <input type="text" id="editNameInput" class="input-field" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
                <div class="btn btn-neon" style="width: 80px; padding: 16px;" id="saveNameBtn">OK</div>
            </div>
        </div>

        <!-- ========== –ú–ê–ì–ê–ó–ò–ù (TELEGRAM STARS) ========== -->
        <div id="shopScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ú–∞–≥–∞–∑–∏–Ω</h2>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">Telegram Stars</h3>
                <div class="grid-2">
                    <div class="card card-hover" style="padding: 16px;" onclick="window.buyStars(100)">
                        <div style="font-size: 24px;">‚≠ê 100</div>
                        <div class="text-cyan">+100</div>
                        <div style="font-size: 12px; color: #8080b0;">‚âà 1.5‚≠ê</div>
                    </div>
                    <div class="card card-hover" style="padding: 16px;" onclick="window.buyStars(500)">
                        <div style="font-size: 24px;">‚≠ê 500</div>
                        <div class="text-cyan">+500</div>
                        <div style="font-size: 12px; color: #8080b0;">‚âà 7‚≠ê</div>
                    </div>
                    <div class="card card-hover" style="padding: 16px;" onclick="window.buyStars(1000)">
                        <div style="font-size: 24px;">‚≠ê 1000</div>
                        <div class="text-cyan">+1000</div>
                        <div style="font-size: 12px; color: #8080b0;">‚âà 13‚≠ê</div>
                    </div>
                    <div class="card card-hover" style="padding: 16px;" onclick="window.buyStars(2500)">
                        <div style="font-size: 24px;">‚≠ê 2500</div>
                        <div class="text-cyan">+2500</div>
                        <div style="font-size: 12px; color: #8080b0;">‚âà 30‚≠ê</div>
                    </div>
                </div>
                <div style="margin-top: 24px; text-align: center; color: #b0b0e0;">
                    –í–∞—à –±–∞–ª–∞–Ω—Å: <span class="text-cyan" id="shopBalance">0</span> ‚≠ê
                </div>
                <div style="margin-top: 16px; font-size: 12px; color: #606090; text-align: center;">
                    * —Ü–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –≤ Telegram Stars
                </div>
            </div>
        </div>

        <!-- ========== PvP –õ–û–ë–ë–ò ========== -->
        <div id="onlineLobby" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">PvP –ª–æ–±–±–∏</h2>
            </div>

            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; background: #0c0c1e; padding: 16px; border-radius: 28px;">
                <span>–û–Ω–ª–∞–π–Ω: <span class="text-cyan" id="lobbyCounter">0</span></span>
                <div class="btn btn-neon" style="padding: 10px 24px;" onclick="window.showCreateRoomModal()">+ –°–æ–∑–¥–∞—Ç—å</div>
            </div>

            <div id="roomsContainer"></div>
        </div>

        <!-- ========== –ù–ê–°–¢–†–û–ô–ö–ò ========== -->
        <div id="settingsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            <div class="card">
                <div style="margin-bottom: 20px; display: flex; justify-content: space-between;">
                    <span>üîä –ó–≤—É–∫</span>
                    <span class="text-cyan">–í–∫–ª</span>
                </div>
                <div style="margin-bottom: 20px; display: flex; justify-content: space-between;">
                    <span>üé® –¢–µ–º–∞</span>
                    <span class="text-cyan">–ù–µ–æ–Ω</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>üì± –ê–Ω–∏–º–∞—Ü–∏–∏</span>
                    <span class="text-cyan">–í—Å–µ</span>
                </div>
            </div>
        </div>

        <!-- ========== –ò–°–¢–û–†–ò–Ø –ò–ì–† ========== -->
        <div id="logsScreen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <div class="btn" style="width: 50px; padding: 12px;" onclick="window.showScreen('mainHub')">‚Üê</div>
                <h2 style="font-size: 26px;">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h2>
            </div>

            <div class="card" style="padding: 16px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px; color: #a0a0c0;">
                    <span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã</span>
                    <span class="text-cyan" id="statsTotal">0‚≠ê</span>
                </div>
                <div id="logsContainer" class="history-container" style="max-height: 400px; overflow-y: auto;">
                    <!-- –õ–æ–≥–∏ –∏–∑ Firebase -->
                </div>
            </div>
        </div>

        <!-- ========== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –≠–ö–†–ê–ù –ò–ì–†–´ ========== -->
        <div id="gameDynamicScreen" class="screen"></div>

        <!-- ========== –ú–û–î–ê–õ –°–û–ó–î–ê–ù–ò–Ø –ö–û–ú–ù–ê–¢–´ ========== -->
        <div id="createRoomModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center;" onclick="if(event.target===this) window.hideCreateRoomModal()">
            <div style="background: #0c0c1c; border-radius: 40px; padding: 24px; width: 320px; border: 2px solid var(--neon-blue); box-shadow: 0 0 40px var(--neon-blue);">
                <h3 style="margin-bottom: 20px; text-align: center;">–°–æ–∑–¥–∞—Ç—å –¥—É—ç–ª—å</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="color: #a0a0c0; margin-bottom: 8px;">–ò–≥—Ä–∞</div>
                    <select id="roomGameSelect" class="input-field" style="padding: 12px;">
                        <option value="rps">–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</option>
                        <option value="coin">–û—Ä—ë–ª –∏ —Ä–µ—à–∫–∞</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="color: #a0a0c0; margin-bottom: 8px;">–°—Ç–∞–≤–∫–∞</div>
                    <input type="number" id="roomBetInput" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞" value="100" min="10" max="10000">
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <div class="btn" style="flex: 1;" onclick="window.hideCreateRoomModal()">–û—Ç–º–µ–Ω–∞</div>
                    <div class="btn btn-neon" style="flex: 1;" onclick="window.createRoom()">–°–æ–∑–¥–∞—Ç—å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== –ß–ê–°–¢–¨ 4/4: PvP –ö–û–ú–ù–ê–¢–´, TELEGRAM STARS, –§–ò–ù–ê–õ ====================
        
        (function() {
            // ===== FIREBASE =====
            const firebaseConfig = {
                apiKey: "AIzaSyDummy123456789",
                authDomain: "duels-neon.firebaseapp.com",
                databaseURL: "https://duels-neon-default-rtdb.firebaseio.com",
                projectId: "duels-neon",
            };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();

            // ===== UID =====
            const tg = window.Telegram?.WebApp || { 
                initDataUnsafe: { user: { id: 12345678 } },
                openInvoice: function(url, callback) { 
                    alert('Telegram Stars: ' + url);
                    if (callback) callback(true);
                }
            };
            
            const tgUser = tg.initDataUnsafe?.user;
            let UID = localStorage.getItem('duels_uid');
            
            if (!UID) {
                if (tgUser) {
                    UID = 'tg_' + tgUser.id;
                } else {
                    UID = 'local_' + Math.random().toString(36).substring(2, 10);
                }
                localStorage.setItem('duels_uid', UID);
            }

            // ===== –°–°–´–õ–ö–ò =====
            const userRef = db.ref('users/' + UID);
            const logsRef = db.ref('logs/' + UID);
            const gamesRef = db.ref('games');

            // ===== –ë–ê–õ–ê–ù–° =====
            window.addStars = async function(amount) {
                let newBal = 0;
                await userRef.child('balance').transaction(b => {
                    newBal = (b || 0) + amount;
                    return newBal;
                });
                updateBalanceUI();
                return newBal;
            }

            window.removeStars = async function(amount) {
                let success = false;
                await userRef.child('balance').transaction(b => {
                    if (b >= amount) {
                        success = true;
                        return b - amount;
                    }
                    return b;
                });
                updateBalanceUI();
                return success;
            }

            async function getBalance() {
                const snap = await userRef.child('balance').once('value');
                return snap.val() || 0;
            }

            async function updateBalanceUI() {
                const bal = await getBalance();
                document.querySelectorAll('#hubBalance, #profileBalance, #shopBalance').forEach(el => {
                    if (el) el.innerText = bal;
                });
            }

            // ===== –õ–û–ì–ò =====
            window.addLog = function(game, bet, result) {
                logsRef.push({
                    game: game,
                    bet: bet,
                    result: result,
                    time: Date.now()
                });
            }

            // ===== –ó–ê–ì–†–£–ó–ö–ê –õ–û–ì–û–í =====
            async function loadLogs() {
                const snap = await logsRef.limitToLast(20).once('value');
                const logs = [];
                snap.forEach(child => logs.push({ id: child.key, ...child.val() }));
                
                const container = document.getElementById('logsContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (logs.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #8080b0; padding: 20px;">–ù–µ—Ç –∏–≥—Ä</div>';
                    return;
                }
                
                let totalProfit = 0;
                
                logs.reverse().forEach(log => {
                    const date = new Date(log.time).toLocaleTimeString();
                    const profit = log.result === 'win' ? log.bet : (log.result === 'draw' ? 0 : -log.bet);
                    totalProfit += profit;
                    
                    const div = document.createElement('div');
                    div.className = 'log-item';
                    
                    let resultClass = 'log-' + log.result;
                    let resultSymbol = log.result === 'win' ? '‚úÖ' : (log.result === 'draw' ? 'üîÑ' : '‚ùå');
                    
                    div.innerHTML = `
                        <div>
                            <span style="font-weight: 600;">${getGameIcon(log.game)} ${log.game}</span>
                            <span style="color: #8080b0; margin-left: 8px;">${date}</span>
                        </div>
                        <div>
                            <span class="${resultClass}">${resultSymbol} ${log.bet}‚≠ê</span>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
                
                document.getElementById('statsTotal').innerText = (totalProfit > 0 ? '+' : '') + totalProfit + '‚≠ê';
            }

            function getGameIcon(game) {
                const icons = {
                    'coin': 'ü™ô',
                    'mines': 'üí£',
                    'rps': '‚úÇÔ∏è',
                    'roulette': 'üé∞',
                    'pvp': '‚öîÔ∏è',
                    'stars_purchase': '‚≠ê'
                };
                return icons[game] || 'üéÆ';
            }

            // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.once('value', (snap) => {
                if (!snap.exists()) {
                    userRef.set({
                        name: 'Player_' + UID.substring(0, 5),
                        avatar: '',
                        balance: 1000,
                        online: true,
                        lastSeen: Date.now(),
                        created: Date.now()
                    });
                }
            });

            // ===== –û–ù–õ–ê–ô–ù –°–¢–ê–¢–£–° =====
            function pingOnline() {
                userRef.update({ online: true, lastSeen: Date.now() });
            }
            
            pingOnline();
            setInterval(pingOnline, 20000);
            
            window.addEventListener('beforeunload', () => {
                userRef.update({ online: false, lastSeen: Date.now() });
            });

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =====
            userRef.on('value', (snap) => {
                const data = snap.val() || {};
                
                document.getElementById('hubPlayerName').innerText = data.name || '‚Äî';
                document.getElementById('profileName').innerText = data.name || '‚Äî';
                document.getElementById('profileUid').innerText = UID;
                document.getElementById('profileBalance').innerText = data.balance || 0;
                document.getElementById('hubBalance').innerText = data.balance || 0;
                document.getElementById('shopBalance').innerText = data.balance || 0;
                
                const created = data.created ? new Date(data.created).toLocaleDateString() : '‚Äî';
                document.getElementById('profileCreated').innerText = created;
                
                const statusDot = document.getElementById('profileStatus');
                if (data.online) {
                    statusDot.className = 'online-dot';
                } else {
                    statusDot.className = 'offline-dot';
                }
            });

            // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
            window.showScreen = function(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-screen') === screenId) {
                        btn.classList.add('active');
                    }
                });

                if (screenId === 'onlineLobby') renderLobby();
                if (screenId === 'logsScreen') loadLogs();
            };

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const screenId = btn.getAttribute('data-screen');
